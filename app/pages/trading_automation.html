<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/theme.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Trading Configuration - Intelligent Stock Investment</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .top-nav {
            position: sticky;
            top: 0;
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .nav-container {
            max-width: 1360px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 72px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-text {
            font-size: 1.3em;
            font-weight: 700;
            color: #c41c16;
            text-decoration: none;
        }

        .page-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #64748b;
            border-left: 2px solid #e5e7eb;
            padding-left: 16px;
        }

        .nav-menu {
            position: relative;
        }

        .menu-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #c41c16;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
        }

        .menu-btn:hover {
            background: #991b1b;
            transform: translateY(-1px);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            min-width: 280px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s;
            z-index: 1001;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .menu-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 700;
            color: #1e293b;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .menu-category {
            padding: 12px 20px 8px;
            font-weight: 700;
            color: #64748b;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-top: 1px solid #e5e7eb;
        }

        .menu-category:first-child {
            border-top: none;
        }


        .menu-items {
            padding: 0 0 8px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #475569;
            text-decoration: none;
            transition: all 0.2s;
            font-weight: 500;
        }

        .menu-item:hover {
            background: #fef2f2;
            color: #c41c16;
        }

        .menu-item-icon {
            font-size: 1.2em;
            width: 24px;
            text-align: center;
        }


        .container {
            max-width: 1360px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .header {
            background: white;
            padding: 32px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }

        .header h1 {
            color: #1e293b;
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .warning-banner {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }

        .card h2 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.6em;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e293b;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #1e3c72;
            box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
        }

        .form-group .hint {
            font-size: 0.9em;
            color: #64748b;
            margin-top: 5px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #10b981;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .btn {
            padding: 12px 30px;
            background: #c41c16;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn:hover {
            background: #991b1b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(196, 28, 22, 0.3);
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .rules-list {
            list-style: none;
            padding: 0;
        }

        .rule-item {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #1e3c72;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rule-item.buy {
            border-left-color: #10b981;
        }

        .rule-item.sell {
            border-left-color: #ef4444;
        }

        .rule-content {
            flex: 1;
        }

        .rule-title {
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 8px;
            color: #1e293b;
        }

        .rule-conditions {
            color: #64748b;
            font-size: 0.95em;
        }

        .rule-actions {
            display: flex;
            gap: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active {
            background: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .status-indicator.inactive {
            background: #94a3b8;
        }

        .status-indicator.error {
            background: #ef4444;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .stats-box {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stats-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 8px;
        }

        .stats-label {
            color: #64748b;
            font-weight: 600;
        }

        .trade-log {
            max-height: 400px;
            overflow-y: auto;
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
        }

        .trade-entry {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #94a3b8;
        }

        .trade-entry.buy {
            border-left-color: #10b981;
        }

        .trade-entry.sell {
            border-left-color: #ef4444;
        }

        .trade-time {
            color: #64748b;
            font-size: 0.9em;
        }

        .trade-details {
            margin-top: 8px;
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            overflow: auto;
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #1e3c72;
            padding-bottom: 15px;
        }

        .modal-header h2 {
            color: #1e3c72;
            margin: 0;
        }

        .close-btn {
            font-size: 2em;
            color: #94a3b8;
            cursor: pointer;
            background: none;
            border: none;
            transition: all 0.3s;
        }

        .close-btn:hover {
            color: #ef4444;
            transform: scale(1.2);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border-left: 5px solid #1e3c72;
        }

        .metric-card.positive {
            border-left-color: #10b981;
        }

        .metric-card.negative {
            border-left-color: #ef4444;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
            margin: 10px 0;
        }

        .metric-value.positive {
            color: #10b981;
        }

        .metric-value.negative {
            color: #ef4444;
        }

        .metric-label {
            color: #64748b;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .metric-sublabel {
            color: #94a3b8;
            font-size: 0.9em;
        }

        .chart-section {
            margin-bottom: 30px;
        }

        .chart-section h3 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .chart-box {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            height: 350px;
        }

        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .trades-table th {
            background: #1e3c72;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .trades-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .trades-table tr:hover {
            background: #f8fafc;
        }

        .trades-table tr.profit {
            background: rgba(16, 185, 129, 0.05);
        }

        .trades-table tr.loss {
            background: rgba(239, 68, 68, 0.05);
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

        }

        /* Footer Styles */
        .footer {
            background: #1e293b;
            color: #cbd5e1;
            padding: 40px 24px 24px;
            margin-top: 60px;
        }

        .footer-container {
            max-width: 1360px;
            margin: 0 auto;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            color: white;
            font-size: 1.1em;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 8px;
        }

        .footer-links a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.2s;
            font-size: 0.9em;
        }

        .footer-links a:hover {
            color: #f59e0b;
        }

        .footer-bottom {
            border-top: 1px solid #334155;
            padding-top: 20px;
            text-align: center;
            color: #94a3b8;
            font-size: 0.85em;
        }

    </style>
    <script src="js/collapsible.js"></script>
    <script src="js/logo.js"></script>
    <script src="js/api-config.js"></script>
    <script src="js/stock-categories.js"></script>
    <script src="js/data-api.js"></script>
    <script src="js/custom-dialogs.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/currency.js"></script>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <div class="logo-section">
                <span class="logo-icon">üìä</span>
                <a href="index.html" class="logo-text">VNStock Analytics</a>
                <span class="page-title" data-i18n="nav.automation">Trading Automation</span>
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="nav-menu">
                    <button class="menu-btn" onclick="toggleMenu()">
                        üìä Dashboards
                        <span id="menuArrow">‚ñº</span>
                    </button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <div class="menu-header" data-i18n="menu.all_dashboards">All Dashboards</div>

                        <div class="menu-category" data-i18n="menu.market_analysis">üìä Market Analysis</div>
                        <div class="menu-items">
                            <a href="dashboard.html" class="menu-item">
                                <span class="menu-item-icon">üìä</span>
                                <span data-i18n="nav.dashboard">Main Dashboard</span>
                            </a>
                            <a href="dashboard_history.html" class="menu-item">
                                <span class="menu-item-icon">üìä</span>
                                <span data-i18n="nav.history">Historical Analysis</span>
                            </a>
                            <a href="advanced_charts.html" class="menu-item">
                                <span class="menu-item-icon">üìâ</span>
                                <span data-i18n="nav.charts">Advanced Charts</span>
                            </a>
                        </div>

                        <div class="menu-category" data-i18n="menu.investment_tools">üíº Investment Tools</div>
                        <div class="menu-items">
                            <a href="price_forecast.html" class="menu-item">
                                <span class="menu-item-icon">üîÆ</span>
                                <span>Price Forecasting</span>
                            </a>
                            <a href="dashboard_advanced.html" class="menu-item">
                                <span class="menu-item-icon">üìä</span>
                                <span data-i18n="nav.portfolio_analytics">Portfolio Analytics</span>
                            </a>
                            <a href="macro_analysis.html" class="menu-item">
                                <span class="menu-item-icon">üåç</span>
                                <span data-i18n="nav.macro">Macro Analysis</span>
                            </a>
                        </div>

                        <div class="menu-category" data-i18n="menu.automation_alerts">üîî Automation & Alerts</div>
                        <div class="menu-items">
                            <a href="alerts_system.html" class="menu-item">
                                <span class="menu-item-icon">üîî</span>
                                <span data-i18n="nav.alerts">Price Alerts</span>
                            </a>
                            <a href="trading_automation.html" class="menu-item">
                                <span class="menu-item-icon">ü§ñ</span>
                                <span data-i18n="nav.automation">Trading Automation</span>
                            </a>
                        </div>
                    <a href="settings.html" class="menu-item">
                            <span class="menu-item-icon">‚öôÔ∏è</span>
                            <span data-i18n="nav.settings">Settings</span>
                        </a>

                    </div>
                

            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1 data-i18n="page.trading_automation">ü§ñ Automated Trading Configuration</h1>
            <p style="color: #666; font-size: 1.1em;">Configure buy/sell rules and API settings</p>
        </div>

        <div class="warning-banner">
            <span data-i18n="trading.warning_banner">‚ö†Ô∏è WARNING: Automated trading involves significant risk. Only enable with proper testing and risk management. You can lose money.</span>
        </div>

        <!-- System Status -->
        <div class="card collapsible">
            <h2 data-i18n="trading.system_status">üìä System Status</h2>
            <div class="card-content">            <div class="grid-2">
                <div class="stats-box">
                    <div class="stats-number" id="systemStatus">
                        <span class="status-indicator inactive"></span> Inactive
                    </div>
                    <div class="stats-label">Trading Status</div>
                </div>
                <div class="stats-box">
                    <div class="stats-number" id="activeRules">0</div>
                    <div class="stats-label" data-i18n="trading.active_rules">Active Rules</div>
                </div>
                <div class="stats-box">
                    <div class="stats-number" id="todayTrades">0</div>
                    <div class="stats-label">Today's Trades</div>
                </div>
                <div class="stats-box">
                    <div class="stats-number" id="totalProfit">‚Ç´0</div>
                    <div class="stats-label">Total P&L</div>
                </div>
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <label style="display: inline-flex; align-items: center; gap: 15px; font-size: 1.2em;">
                    <span>Master Trading Switch:</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="masterSwitch" onchange="toggleMasterSwitch()">
                        <span class="slider"></span>
                    </label>
                    <span id="switchStatus" style="font-weight: 700; color: #94a3b8;">OFF</span>
                </label>
            </div>
        </div>

        <!-- API Configuration -->
        <div class="card collapsible">
            <h2 data-i18n="trading.broker_api">üîå Broker API Configuration</h2>
            <div class="card-content">            <form id="apiConfigForm">
                <div class="form-group">
                    <label data-i18n="trading.broker">Broker</label>
                    <select id="broker" required>
                        <option value="" data-i18n="trading.select_broker">-- Select Broker --</option>
                        <option value="vndirect">VNDirect</option>
                        <option value="ssi">SSI Securities</option>
            </div>                        <option value="vps">VPS Securities</option>
                        <option value="tcbs">TCBS</option>
                        <option value="custom">Custom API</option>
                    </select>
                    <div class="hint" data-i18n="trading.broker_hint">Choose your brokerage firm</div>
                </div>

                <div class="form-group">
                    <label data-i18n="settings.api_key">API Key</label>
                    <input type="password" id="apiKey" data-i18n-placeholder="settings.api_key_placeholder" placeholder="Enter your API key" required>
                    <div class="hint" data-i18n="settings.api_key_hint">Your broker's API key (kept secure)</div>
                </div>

                <div class="form-group">
                    <label data-i18n="trading.api_secret">API Secret</label>
                    <input type="password" id="apiSecret" data-i18n-placeholder="trading.api_secret_placeholder" placeholder="Enter your API secret" required>
                    <div class="hint" data-i18n="trading.api_secret_hint">Your broker's API secret (encrypted)</div>
                </div>

                <div class="form-group">
                    <label data-i18n="trading.account_number">Account Number</label>
                    <input type="text" id="accountNumber" data-i18n-placeholder="trading.account_number_placeholder" placeholder="Trading account number" required>
                </div>

                <div class="form-group">
                    <label data-i18n="trading.api_endpoint">API Endpoint (Optional)</label>
                    <input type="url" id="apiEndpoint" data-i18n-placeholder="trading.api_endpoint_placeholder" placeholder="https://api.broker.com">
                    <div class="hint" data-i18n="trading.api_endpoint_hint">Custom API endpoint if using custom broker</div>
                </div>

                <button type="button" class="btn btn-success" onclick="testConnection()" data-i18n="button.test_connection">
                    üîç Test Connection
                </button>
                <button type="button" class="btn" onclick="saveApiConfig()" data-i18n="button.save_config">
                    üíæ Save Configuration
                </button>
            </form>
        </div>

        <!-- Trading Rules -->
        <div class="card collapsible">
            <h2 data-i18n="trading.rules">üìã Trading Rules</h2>
            <div class="card-content">            <button class="btn btn-success" onclick="showAddRuleModal()" data-i18n="button.add_rule">
                ‚ûï Add New Rule
            </button>

            <div style="margin-top: 30px;">
                <h3 style="color: #1e293b; margin-bottom: 15px;" data-i18n="trading.active_rules">Active Rules</h3>
            </div>                <ul class="rules-list" id="rulesList">
                    <!-- Rules will be populated here -->
                    <li class="rule-item buy">
                        <div class="rule-content">
                            <div class="rule-title">
                                <span class="status-indicator active"></span>
                                Buy Rule: Oversold RSI
                            </div>
                            <div class="rule-conditions">
                                IF RSI < 30 AND Price > MA50 THEN Buy 1000 shares
                            </div>
                        </div>
                        <div class="rule-actions">
                            <button class="btn" onclick="editRule(1)" data-i18n="button.edit">‚úèÔ∏è Edit</button>
                            <button class="btn btn-danger" onclick="deleteRule(1)" data-i18n="button.delete">üóëÔ∏è Delete</button>
                        </div>
                    </li>

                    <li class="rule-item sell">
                        <div class="rule-content">
                            <div class="rule-title">
                                <span class="status-indicator active"></span>
                                Sell Rule: Overbought RSI
                            </div>
                            <div class="rule-conditions">
                                IF RSI > 70 AND Profit > 5% THEN Sell 100%
                            </div>
                        </div>
                        <div class="rule-actions">
                            <button class="btn" onclick="editRule(2)" data-i18n="button.edit">‚úèÔ∏è Edit</button>
                            <button class="btn btn-danger" onclick="deleteRule(2)" data-i18n="button.delete">üóëÔ∏è Delete</button>
                        </div>
                    </li>

                    <li class="rule-item buy">
                        <div class="rule-content">
                            <div class="rule-title">
                                <span class="status-indicator inactive"></span>
                                Buy Rule: Golden Cross
                            </div>
                            <div class="rule-conditions">
                                IF MA20 crosses above MA50 THEN Buy ‚Ç´5,000,000
                            </div>
                        </div>
                        <div class="rule-actions">
                            <button class="btn" onclick="editRule(3)" data-i18n="button.edit">‚úèÔ∏è Edit</button>
                            <button class="btn btn-danger" onclick="deleteRule(3)" data-i18n="button.delete">üóëÔ∏è Delete</button>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Risk Management -->
        <div class="card collapsible">
            <h2 data-i18n="advanced.risk_management">üõ°Ô∏è Risk Management</h2>
            <div class="card-content">            <div class="grid-2">
                <div class="form-group">
                    <label data-i18n="trading.max_position_size">Max Position Size (VND)</label>
                    <input type="number" id="maxPosition" value="10000000" min="0">
            </div>                    <div class="hint" data-i18n="trading.hint_max_position">Maximum investment per trade</div>
                </div>

                <div class="form-group">
                    <label data-i18n="trading.max_daily_loss">Max Daily Loss (%)</label>
                    <input type="number" id="maxDailyLoss" value="5" min="0" max="100" step="0.1">
                    <div class="hint" data-i18n="trading.hint_max_daily_loss">Stop trading if daily loss exceeds this</div>
                </div>

                <div class="form-group">
                    <label data-i18n="trading.stop_loss_pct">Stop Loss (%)</label>
                    <input type="number" id="stopLoss" value="3" min="0" max="100" step="0.1">
                    <div class="hint" data-i18n="trading.hint_stop_loss">Auto-sell if loss exceeds this</div>
                </div>

                <div class="form-group">
                    <label data-i18n="trading.take_profit_pct">Take Profit (%)</label>
                    <input type="number" id="takeProfit" value="10" min="0" step="0.1">
                    <div class="hint" data-i18n="trading.hint_take_profit">Auto-sell if profit reaches this</div>
                </div>

                <div class="form-group">
                    <label data-i18n="trading.max_open_positions">Max Open Positions</label>
                    <input type="number" id="maxPositions" value="5" min="1" max="50">
                    <div class="hint" data-i18n="trading.hint_max_positions">Maximum concurrent holdings</div>
                </div>

                <div class="form-group">
                    <label data-i18n="trading.cooldown_period">Cooldown Period (minutes)</label>
                    <input type="number" id="cooldown" value="15" min="0">
                    <div class="hint" data-i18n="trading.hint_cooldown">Wait time between trades on same stock</div>
                </div>
            </div>

            <button class="btn btn-success" onclick="saveRiskConfig()" data-i18n="trading.save_risk_settings">
                üíæ Save Risk Settings
            </button>
        </div>

        <!-- Trade Log -->
        <div class="card collapsible">
            <h2 data-i18n="trading.execution_log">üìú Trade Execution Log</h2>
            <div class="card-content">            <div class="trade-log" id="tradeLog">
            </div>                <div class="trade-entry buy">
                    <div class="trade-time">2026-01-31 14:23:15</div>
                    <div class="trade-details">
                        üü¢ BUY: VCB x 100 shares @ ‚Ç´86,500 | Rule: Oversold RSI
                    </div>
                </div>

                <div class="trade-entry sell">
                    <div class="trade-time">2026-01-31 13:45:30</div>
                    <div class="trade-details">
                        üî¥ SELL: HPG x 200 shares @ ‚Ç´29,100 | Rule: Take Profit 10% | Profit: ‚Ç´580,000
                    </div>
                </div>

                <div class="trade-entry buy">
                    <div class="trade-time">2026-01-31 10:15:45</div>
                    <div class="trade-details">
                        üü¢ BUY: FPT x 50 shares @ ‚Ç´112,000 | Rule: Golden Cross
                    </div>
                </div>
            </div>
        </div>

        <!-- Backtesting -->
        <div class="card collapsible">
            </div>            <h2 data-i18n="trading.backtest_simulation">üß™ Backtesting & Simulation</h2>
            <div class="card-content">            <p style="color: #64748b; margin-bottom: 20px;" data-i18n="trading.backtest_description">
                Test your trading rules on historical data before enabling live trading.
            </p>

            <div class="form-group">
                <label data-i18n="trading.backtest_period">Backtesting Period</label>
                <select id="backtestPeriod">
                    <option value="30" data-i18n="trading.last_30_days">Last 30 Days</option>
                    <option value="60" selected data-i18n="history.last_60_days">Last 60 Days</option>
                    <option value="90" data-i18n="trading.last_90_days">Last 90 Days</option>
                    <option value="180" data-i18n="trading.last_6_months">Last 6 Months</option>
                    <option value="365" data-i18n="trading.last_year">Last Year</option>
                </select>
            </div>

            <button class="btn btn-success" onclick="runBacktest()" data-i18n="trading.run_backtest">
                ‚ñ∂Ô∏è Run Backtest
            </button>
            <button class="btn" onclick="viewBacktestResults()" data-i18n="trading.view_results">
                üìä View Results
            </button>
        </div>
    </div>

            </div>    <!-- Backtest Results Modal -->
    <div id="backtestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="trading.backtest_results">üß™ Backtest Results</h2>
                <button class="close-btn" onclick="closeBacktestModal()">&times;</button>
            </div>

            <!-- Performance Metrics -->
            <div class="results-grid" id="metricsGrid">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Equity Curve -->
            <div class="chart-section">
                <h3 data-i18n="trading.equity_curve">üìà Equity Curve</h3>
                <div class="chart-box">
                    <canvas id="equityCurveChart"></canvas>
                </div>
            </div>

            <!-- Monthly Returns -->
            <div class="chart-section">
                <h3 data-i18n="trading.monthly_returns">üìä Monthly Returns</h3>
                <div class="chart-box">
                    <canvas id="monthlyReturnsChart"></canvas>
                </div>
            </div>

            <!-- Trade Distribution -->
            <div class="chart-section">
                <h3 data-i18n="trading.win_loss_distribution">üìä Win/Loss Distribution</h3>
                <div class="chart-box">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>

            <!-- Detailed Trades Table -->
            <div class="chart-section">
                <h3 data-i18n="section.trade_history">üìã Trade History</h3>
                <div style="overflow-x: auto; max-height: 400px; overflow-y: auto;">
                    <table class="trades-table" id="tradesTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th data-i18n="table.date">Date</th>
                                <th data-i18n="table.stock">Stock</th>
                                <th data-i18n="table.action">Action</th>
                                <th data-i18n="table.price">Price</th>
                                <th data-i18n="table.quantity">Quantity</th>
                                <th data-i18n="table.pnl">P&L</th>
                                <th data-i18n="table.pnl_percent">P&L %</th>
                                <th data-i18n="table.rule">Rule</th>
                            </tr>
                        </thead>
                        <tbody id="tradesTableBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script>
        let tradingEnabled = false;
        let apiConnected = false;
        let backtestResults = null;
        let backtestCharts = {};

        function toggleMasterSwitch() {
            const checkbox = document.getElementById('masterSwitch');
            const status = document.getElementById('switchStatus');
            const systemStatus = document.getElementById('systemStatus');

            tradingEnabled = checkbox.checked;

            if (tradingEnabled) {
                if (!apiConnected) {
                    alert('‚ö†Ô∏è ' + t('trading.alert_configure_api'));
                    checkbox.checked = false;
                    return;
                }

                if (!confirm('‚ö†Ô∏è ' + t('trading.confirm_enable_title') + '\n\n' + t('trading.confirm_enable_message'))) {
                    checkbox.checked = false;
                    return;
                }

                status.textContent = 'ON';
                status.style.color = '#10b981';
                systemStatus.innerHTML = '<span class="status-indicator active"></span> Active';
                systemStatus.style.color = '#10b981';

                // Save to backend
                saveAutomationState(true);
                alert('‚úÖ ' + t('trading.success_trading_enabled'));
            } else {
                status.textContent = 'OFF';
                status.style.color = '#94a3b8';
                systemStatus.innerHTML = '<span class="status-indicator inactive"></span> Inactive';
                systemStatus.style.color = '#94a3b8';

                saveAutomationState(false);
                alert('‚è∏Ô∏è ' + t('trading.success_trading_disabled'));
            }
        }

        async function testConnection() {
            const broker = document.getElementById('broker').value;
            const apiKey = document.getElementById('apiKey').value;

            if (!broker || !apiKey) {
                alert('‚ö†Ô∏è ' + t('trading.alert_fill_broker'));
                return;
            }

            alert('üîÑ Testing connection...\n\nThis is a demo. In production, this would:\n' +
                  '1. Validate API credentials\n' +
                  '2. Check account access\n' +
                  '3. Verify trading permissions\n' +
                  '4. Test order placement (dry run)');

            // Simulate API test
            setTimeout(() => {
                apiConnected = true;
                alert('‚úÖ Connection successful!\n\n' +
                      'Broker: ' + broker.toUpperCase() + '\n' +
                      'Account verified\n' +
                      'Trading enabled\n\n' +
                      'You can now enable automated trading.');
            }, 1500);
        }

        function saveApiConfig() {
            const config = {
                broker: document.getElementById('broker').value,
                apiKey: document.getElementById('apiKey').value,
                apiSecret: document.getElementById('apiSecret').value,
                accountNumber: document.getElementById('accountNumber').value,
                apiEndpoint: document.getElementById('apiEndpoint').value
            };

            // In production, this would save to backend with encryption
            localStorage.setItem('apiConfig', JSON.stringify(config));
            alert('‚úÖ ' + t('trading.success_api_saved'));
        }

        function showAddRuleModal() {
            const rule = prompt(
                '‚ûï Add New Trading Rule\n\n' +
                'Format: [BUY/SELL] IF [condition] THEN [action]\n\n' +
                'Examples:\n' +
                '‚Ä¢ BUY IF RSI < 30 AND Score > 20 THEN 1000 shares\n' +
                '‚Ä¢ SELL IF RSI > 70 OR Loss > 3% THEN 100%\n' +
                '‚Ä¢ BUY IF MA20 > MA50 THEN ‚Ç´5,000,000\n\n' +
                'Enter your rule:'
            );

            if (rule) {
                alert('‚úÖ Rule added!\n\n' + rule + '\n\nRule will be active when trading is enabled.');
                // In production, save to backend
            }
        }

        function editRule(id) {
            alert('‚úèÔ∏è Edit Rule #' + id + '\n\nThis would open a form to modify the rule conditions and actions.');
        }

        function deleteRule(id) {
            if (confirm('üóëÔ∏è Delete this rule?\n\nThis action cannot be undone.')) {
                alert('‚úÖ ' + t('trading.success_rule_deleted'));
            }
        }

        function saveRiskConfig() {
            const config = {
                maxPosition: document.getElementById('maxPosition').value,
                maxDailyLoss: document.getElementById('maxDailyLoss').value,
                stopLoss: document.getElementById('stopLoss').value,
                takeProfit: document.getElementById('takeProfit').value,
                maxPositions: document.getElementById('maxPositions').value,
                cooldown: document.getElementById('cooldown').value
            };

            localStorage.setItem('riskConfig', JSON.stringify(config));
            alert('‚úÖ ' + t('trading.success_risk_saved'));
        }

        function runBacktest() {
            const period = parseInt(document.getElementById('backtestPeriod').value);
            alert('üß™ Starting backtest...\n\n' +
                  'Period: Last ' + period + ' days\n' +
                  'Testing all active rules\n\n' +
                  'This will take a few moments...');

            setTimeout(() => {
                try {
                    // Generate backtest results
                    backtestResults = generateBacktestResults(period);
                    console.log('Backtest completed:', backtestResults);

                    alert('‚úÖ Backtest Complete!\n\n' +
                      'Total Trades: ' + backtestResults.totalTrades + '\n' +
                      'Win Rate: ' + backtestResults.winRate.toFixed(1) + '%\n' +
                      'Profit/Loss: ' + formatCurrency(backtestResults.totalPL) + '\n' +
                      'Sharpe Ratio: ' + backtestResults.sharpeRatio.toFixed(2) + '\n' +
                      'Max Drawdown: ' + backtestResults.maxDrawdown.toFixed(1) + '%\n\n' +
                      'Click "View Results" for detailed analysis.');
                } catch (error) {
                    console.error('Error generating backtest:', error);
                    alert('‚ö†Ô∏è ' + t('trading.error_generating_backtest') + ' ' + error.message);
                }
            }, 2000);
        }

        function generateBacktestResults(days) {
            const initialCapital = 10000000; // 10M VND
            let capital = initialCapital;
            const trades = [];
            const equityCurve = [];
            const monthlyReturns = {};

            // Generate trades
            const numTrades = Math.floor(days / 3) + Math.floor(Math.random() * 10);
            const stocks = ['VCB', 'HPG', 'FPT', 'VNM', 'GAS', 'MBB', 'ACB', 'STB'];

            for (let i = 0; i < numTrades; i++) {
                const daysAgo = Math.floor(Math.random() * days);
                const tradeDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);

                const stock = stocks[Math.floor(Math.random() * stocks.length)];
                const buyPrice = 50000 + Math.random() * 100000;
                const quantity = Math.floor(capital * 0.2 / buyPrice);

                // Simulate holding period
                const holdDays = 3 + Math.floor(Math.random() * 10);
                const sellDate = new Date(tradeDate.getTime() + holdDays * 24 * 60 * 60 * 1000);

                // 68% win rate
                const isWin = Math.random() < 0.68;
                const priceChange = isWin ?
                    (0.02 + Math.random() * 0.15) : // Win: 2-17% gain
                    (-0.01 - Math.random() * 0.05); // Loss: 1-6% loss

                const sellPrice = buyPrice * (1 + priceChange);
                const pl = (sellPrice - buyPrice) * quantity;
                const plPercent = priceChange * 100;

                capital += pl;

                trades.push({
                    date: tradeDate,
                    stock: stock,
                    action: 'BUY',
                    buyPrice: buyPrice,
                    sellPrice: sellPrice,
                    quantity: quantity,
                    pl: pl,
                    plPercent: plPercent,
                    capital: capital,
                    rule: isWin ? 'Oversold RSI' : 'Golden Cross'
                });

                equityCurve.push({
                    date: sellDate,
                    equity: capital
                });

                // Track monthly returns
                const monthKey = sellDate.getFullYear() + '-' + (sellDate.getMonth() + 1);
                monthlyReturns[monthKey] = (monthlyReturns[monthKey] || 0) + pl;
            }

            // Sort by date
            trades.sort((a, b) => a.date - b.date);
            equityCurve.sort((a, b) => a.date - b.date);

            // Calculate metrics
            const winningTrades = trades.filter(t => t.pl > 0);
            const losingTrades = trades.filter(t => t.pl < 0);
            const winRate = (winningTrades.length / trades.length) * 100;
            const totalPL = capital - initialCapital;
            const totalReturn = (totalPL / initialCapital) * 100;

            // Calculate Sharpe Ratio
            const returns = trades.map(t => t.plPercent);
            const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
            const stdDev = Math.sqrt(returns.reduce((sq, n) => sq + Math.pow(n - avgReturn, 2), 0) / returns.length);
            const sharpeRatio = avgReturn / (stdDev || 1);

            // Calculate max drawdown
            let peak = initialCapital;
            let maxDrawdown = 0;
            equityCurve.forEach(point => {
                if (point.equity > peak) peak = point.equity;
                const drawdown = ((peak - point.equity) / peak) * 100;
                if (drawdown > maxDrawdown) maxDrawdown = drawdown;
            });

            return {
                trades: trades,
                equityCurve: equityCurve,
                monthlyReturns: monthlyReturns,
                totalTrades: trades.length,
                winningTrades: winningTrades.length,
                losingTrades: losingTrades.length,
                winRate: winRate,
                totalPL: totalPL,
                totalReturn: totalReturn,
                sharpeRatio: sharpeRatio,
                maxDrawdown: maxDrawdown,
                initialCapital: initialCapital,
                finalCapital: capital,
                avgWin: winningTrades.length > 0 ?
                    winningTrades.reduce((sum, t) => sum + t.pl, 0) / winningTrades.length : 0,
                avgLoss: losingTrades.length > 0 ?
                    losingTrades.reduce((sum, t) => sum + t.pl, 0) / losingTrades.length : 0
            };
        }

        function viewBacktestResults() {
            if (!backtestResults) {
                alert('‚ö†Ô∏è ' + t('trading.alert_run_backtest_first'));
                return;
            }

            try {
                displayBacktestResults();
                document.getElementById('backtestModal').classList.add('show');
            } catch (error) {
                console.error('Error displaying backtest results:', error);
                alert('‚ö†Ô∏è ' + t('trading.error_displaying_results') + '\n\n' + error.message);
            }
        }

        function closeBacktestModal() {
            const modal = document.getElementById('backtestModal');
            modal.classList.remove('show');

            // Destroy all charts to prevent canvas reuse errors
            if (backtestCharts.equityCurve) {
                backtestCharts.equityCurve.destroy();
                backtestCharts.equityCurve = null;
            }
            if (backtestCharts.monthlyReturns) {
                backtestCharts.monthlyReturns.destroy();
                backtestCharts.monthlyReturns = null;
            }
            if (backtestCharts.distribution) {
                backtestCharts.distribution.destroy();
                backtestCharts.distribution = null;
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('backtestModal');
            if (event.target === modal) {
                closeBacktestModal();
            }
        };

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('backtestModal');
                if (modal.classList.contains('show')) {
                    closeBacktestModal();
                }
            }
        });

        function displayBacktestResults() {
            const results = backtestResults;

            console.log('Displaying backtest results:', results);

            // Display metrics
            const metricsHTML = `
                <div class="metric-card ${results.totalPL > 0 ? 'positive' : 'negative'}">
                    <div class="metric-label">Total Profit/Loss</div>
                    <div class="metric-value ${results.totalPL > 0 ? 'positive' : 'negative'}">
                        ${formatCurrency(results.totalPL)}
                    </div>
                    <div class="metric-sublabel">${results.totalReturn.toFixed(2)}% Return</div>
                </div>

                <div class="metric-card">
                    <div class="metric-label">Total Trades</div>
                    <div class="metric-value">${results.totalTrades}</div>
                    <div class="metric-sublabel">${results.winningTrades}W / ${results.losingTrades}L</div>
                </div>

                <div class="metric-card ${results.winRate > 50 ? 'positive' : 'negative'}">
                    <div class="metric-label">Win Rate</div>
                    <div class="metric-value">${results.winRate.toFixed(1)}%</div>
                    <div class="metric-sublabel">${results.winningTrades} winning trades</div>
                </div>

                <div class="metric-card ${results.sharpeRatio > 1 ? 'positive' : 'negative'}">
                    <div class="metric-label">Sharpe Ratio</div>
                    <div class="metric-value">${results.sharpeRatio.toFixed(2)}</div>
                    <div class="metric-sublabel">Risk-adjusted return</div>
                </div>

                <div class="metric-card ${results.maxDrawdown < 10 ? 'positive' : 'negative'}">
                    <div class="metric-label">Max Drawdown</div>
                    <div class="metric-value negative">${results.maxDrawdown.toFixed(1)}%</div>
                    <div class="metric-sublabel">Peak to trough</div>
                </div>

                <div class="metric-card positive">
                    <div class="metric-label">Avg Win</div>
                    <div class="metric-value positive">${formatCurrency(results.avgWin)}</div>
                    <div class="metric-sublabel">Per winning trade</div>
                </div>

                <div class="metric-card negative">
                    <div class="metric-label">Avg Loss</div>
                    <div class="metric-value negative">${formatCurrency(results.avgLoss)}</div>
                    <div class="metric-sublabel">Per losing trade</div>
                </div>

                <div class="metric-card">
                    <div class="metric-label">Final Capital</div>
                    <div class="metric-value">${formatCurrency(results.finalCapital)}</div>
                    <div class="metric-sublabel">From ${formatCurrency(results.initialCapital)}</div>
                </div>
            `;
            document.getElementById('metricsGrid').innerHTML = metricsHTML;

            // Display equity curve
            renderEquityCurve(results);

            // Display monthly returns
            renderMonthlyReturns(results);

            // Display distribution
            renderDistribution(results);

            // Display trades table
            renderTradesTable(results);
        }

        function renderEquityCurve(results) {
            const canvas = document.getElementById('equityCurveChart');
            const ctx = canvas.getContext('2d');

            // Destroy existing chart
            if (backtestCharts.equityCurve) {
                backtestCharts.equityCurve.destroy();
                backtestCharts.equityCurve = null;
            }

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const data = results.equityCurve.map(point => ({
                x: point.date,
                y: point.equity
            }));

            // Use labels instead of time scale for better compatibility
            const labels = results.equityCurve.map(point => point.date.toLocaleDateString());
            const values = results.equityCurve.map(point => point.equity);

            backtestCharts.equityCurve = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Portfolio Value',
                        data: values,
                        borderColor: results.totalPL > 0 ? '#10b981' : '#ef4444',
                        backgroundColor: results.totalPL > 0 ?
                            'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Value: ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderMonthlyReturns(results) {
            const canvas = document.getElementById('monthlyReturnsChart');
            const ctx = canvas.getContext('2d');

            // Destroy existing chart
            if (backtestCharts.monthlyReturns) {
                backtestCharts.monthlyReturns.destroy();
                backtestCharts.monthlyReturns = null;
            }

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const months = Object.keys(results.monthlyReturns).sort();
            const returns = months.map(m => results.monthlyReturns[m]);
            const colors = returns.map(r => r > 0 ? 'rgba(16, 185, 129, 0.7)' : 'rgba(239, 68, 68, 0.7)');

            backtestCharts.monthlyReturns = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Monthly P&L',
                        data: returns,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.7', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderDistribution(results) {
            const canvas = document.getElementById('distributionChart');
            const ctx = canvas.getContext('2d');

            // Destroy existing chart
            if (backtestCharts.distribution) {
                backtestCharts.distribution.destroy();
                backtestCharts.distribution = null;
            }

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            backtestCharts.distribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Winning Trades', 'Losing Trades'],
                    datasets: [{
                        data: [results.winningTrades, results.losingTrades],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function renderTradesTable(results) {
            const tbody = document.getElementById('tradesTableBody');

            const html = results.trades.map((trade, index) => {
                const rowClass = trade.pl > 0 ? 'profit' : 'loss';
                return `
                    <tr class="${rowClass}">
                        <td>${index + 1}</td>
                        <td>${trade.date.toLocaleDateString()}</td>
                        <td><strong>${trade.stock}</strong></td>
                        <td>BUY ‚Üí SELL</td>
                        <td>${formatCurrency(trade.buyPrice)}</td>
                        <td>${trade.quantity}</td>
                        <td style="color: ${trade.pl > 0 ? '#10b981' : '#ef4444'}; font-weight: 700;">
                            ${trade.pl > 0 ? '+' : ''}${formatCurrency(trade.pl)}
                        </td>
                        <td style="color: ${trade.pl > 0 ? '#10b981' : '#ef4444'}; font-weight: 700;">
                            ${trade.plPercent > 0 ? '+' : ''}${trade.plPercent.toFixed(2)}%
                        </td>
                        <td>${trade.rule}</td>
                    </tr>
                `;
            }).join('');

            tbody.innerHTML = html;
        }

        function formatCurrency(value) {
            const absValue = Math.abs(value);
            if (absValue >= 1000000) {
                return (value / 1000000).toFixed(2) + 'M';
            } else if (absValue >= 1000) {
                return (value / 1000).toFixed(1) + 'K';
            }
            return '‚Ç´' + new Intl.NumberFormat('vi-VN').format(Math.round(value));
        }

        async function saveAutomationState(enabled) {
            try {
                await fetch(`${window.API_BASE_URL || ''}/api/automation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: enabled })
                });
            } catch (error) {
                console.error('Error saving automation state:', error);
            }
        }

        // Load saved configuration
        window.onload = function() {
            const apiConfig = localStorage.getItem('apiConfig');
            if (apiConfig) {
                const config = JSON.parse(apiConfig);
                document.getElementById('broker').value = config.broker || '';
                document.getElementById('accountNumber').value = config.accountNumber || '';
                document.getElementById('apiEndpoint').value = config.apiEndpoint || '';
            }

            const riskConfig = localStorage.getItem('riskConfig');
            if (riskConfig) {
                const config = JSON.parse(riskConfig);
                document.getElementById('maxPosition').value = config.maxPosition || 10000000;
                document.getElementById('maxDailyLoss').value = config.maxDailyLoss || 5;
                document.getElementById('stopLoss').value = config.stopLoss || 3;
                document.getElementById('takeProfit').value = config.takeProfit || 10;
                document.getElementById('maxPositions').value = config.maxPositions || 5;
                document.getElementById('cooldown').value = config.cooldown || 15;
            }
        };
    </script>
    <script>
        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            const arrow = document.getElementById('menuArrow');
            menu.classList.toggle('active');
            arrow.textContent = menu.classList.contains('active') ? '‚ñ≤' : '‚ñº';
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            const menuBtn = event.target.closest('.menu-btn');
            if (!menuBtn && !event.target.closest('.dropdown-menu')) {
                menu.classList.remove('active');
                const arrow = document.getElementById('menuArrow');
                if (arrow) arrow.textContent = '‚ñº';
            }
        });
    </script>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3 data-i18n="menu.dashboards">Dashboards</h3>
                    <ul class="footer-links">
                        <li><a href="index.html" data-i18n="nav.home">Home</a></li>
                        <li><a href="dashboard.html" data-i18n="nav.dashboard">Main Dashboard</a></li>
                        <li><a href="dashboard_history.html" data-i18n="nav.history">Historical Analysis</a></li>
                        <li><a href="advanced_charts.html">Advanced Charts</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3 data-i18n="menu.tools">Tools</h3>
                    <ul class="footer-links">
                        <li><a href="price_forecast.html" data-i18n="nav.forecast">Price Forecasting</a></li>
                        <li><a href="dashboard_advanced.html" data-i18n="portfolio.title">Portfolio Analytics</a></li>
                        <li><a href="macro_analysis.html" data-i18n="home.macro_analysis">Macro Analysis</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3 data-i18n="menu.automation">Automation</h3>
                    <ul class="footer-links">
                        <li><a href="alerts_system.html" data-i18n="home.price_alerts">Price Alerts</a></li>
                        <li><a href="trading_automation.html" data-i18n="nav.automation">Trading Automation</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3 data-i18n="menu.platform">Platform</h3>
                    <ul class="footer-links">
                        <li><a href="../docs/api/API_SERVER_SETUP.html">API Documentation</a></li>
                        <li><a href="../docs/api/README_API.html">Quick Start</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>¬© 2024 VNStock Analytics</p>
                <p style="margin-top: 8px;" data-i18n="footer.disclaimer">For educational purposes only. Not financial advice. Trade at your own risk.</p>
            </div>
        </div>
    </footer>

</body>
</html>
