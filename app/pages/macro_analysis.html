<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/theme.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="macro.title">Macro & Environmental Analysis - VNStock Analytics</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .top-nav {
            position: sticky;
            top: 0;
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .nav-container {
            max-width: 1360px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 72px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-text {
            font-size: 1.3em;
            font-weight: 700;
            color: #c41c16;
            text-decoration: none;
        }

        .page-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #64748b;
            border-left: 2px solid #e5e7eb;
            padding-left: 16px;
        }

        .nav-menu {
            position: relative;
        }

        .menu-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #c41c16;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
        }

        .menu-btn:hover {
            background: #991b1b;
            transform: translateY(-1px);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            min-width: 280px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s;
            z-index: 1001;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .menu-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 700;
            color: #1e293b;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .menu-category {
            padding: 12px 20px 8px;
            font-weight: 700;
            color: #64748b;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-top: 1px solid #e5e7eb;
        }

        .menu-category:first-child {
            border-top: none;
        }


        .menu-items {
            padding: 0 0 8px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #475569;
            text-decoration: none;
            transition: all 0.2s;
            font-weight: 500;
        }

        .menu-item:hover {
            background: #fef2f2;
            color: #c41c16;
        }

        .menu-item-icon {
            font-size: 1.2em;
            width: 24px;
            text-align: center;
        }


        .container {
            max-width: 1360px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .header {
            background: white;
            padding: 32px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }

        .header h1 {
            color: #1e293b;
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }

        .card h2 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.6em;
            font-weight: 700;
            letter-spacing: -0.5px;
            text-align: left;
        }

        h3 {
            text-align: left;
        }

        .factors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .factor-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            border-left: 4px solid #c41c16;
        }

        .factor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .factor-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #1e293b;
        }

        .factor-icon {
            font-size: 2em;
        }

        .factor-value {
            font-size: 2em;
            font-weight: 700;
            color: #c41c16;
            margin-bottom: 10px;
        }

        .factor-change {
            font-size: 1.1em;
            font-weight: 600;
        }

        .factor-change.positive {
            color: #10b981;
        }

        .factor-change.negative {
            color: #ef4444;
        }

        .factor-impact {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #cbd5e1;
        }

        .impact-label {
            color: #64748b;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .impact-stocks {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .stock-tag {
            background: #fef2f2;
            color: #c41c16;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .stock-tag.high {
            background: #dcfce7;
            color: #166534;
        }

        .stock-tag.negative {
            background: #fee2e2;
            color: #991b1b;
        }

        .sentiment-bar {
            width: 100%;
            height: 30px;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 25%, #fbbf24 50%, #84cc16 75%, #10b981 100%);
            border-radius: 15px;
            position: relative;
            margin: 15px 0;
        }

        .sentiment-indicator {
            position: absolute;
            top: -10px;
            width: 4px;
            height: 50px;
            background: #1e293b;
            border-radius: 2px;
        }

        .sentiment-label {
            text-align: center;
            font-weight: 600;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .news-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #c41c16;
        }

        .news-title {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .news-meta {
            display: flex;
            gap: 15px;
            color: #64748b;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .news-sentiment {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.85em;
        }

        .news-sentiment.positive {
            background: #dcfce7;
            color: #166534;
        }

        .news-sentiment.negative {
            background: #fee2e2;
            color: #991b1b;
        }

        .news-sentiment.neutral {
            background: #f1f5f9;
            color: #475569;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .correlation-matrix {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f8fafc;
            font-weight: 700;
            color: #1e293b;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f8fafc;
        }

        .risk-level {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
        }

        .risk-level.low {
            background: #dcfce7;
            color: #166534;
        }

        .risk-level.medium {
            background: #fef3c7;
            color: #92400e;
        }

        .risk-level.high {
            background: #fee2e2;
            color: #991b1b;
        }

        .risk-level.critical {
            background: #fecaca;
            color: #7f1d1d;
        }

        .alert-box {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid;
        }

        .alert-box.warning {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }

        .alert-box.danger {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .alert-box.info {
            background: #fee2e2;
            border-color: #dc2626;
            color: #1f2937;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: #f1f5f9;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e2e8f0;
        }

        .tab.active {
            background: #3a7ca5;
            color: white;
            border-color: #3a7ca5;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metric-box {
            background: linear-gradient(135deg, #3a7ca5 0%, #2d5a7b 100%);
            padding: 20px;
            border-radius: 12px;
            color: white;
            text-align: center;
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: 700;
        }

        /* Footer Styles */
        .footer {
            background: #1e293b;
            color: #cbd5e1;
            padding: 40px 24px 24px;
            margin-top: 60px;
        }

        .footer-container {
            max-width: 1360px;
            margin: 0 auto;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            color: white;
            font-size: 1.1em;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 8px;
        }

        .footer-links a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.2s;
            font-size: 0.9em;
        }

        .footer-links a:hover {
            color: #f59e0b;
        }

        .footer-bottom {
            border-top: 1px solid #334155;
            padding-top: 20px;
            text-align: center;
            color: #94a3b8;
            font-size: 0.85em;
        }

        /* News & Events Styles */
        .news-filter-btn {
            padding: 12px 24px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875em;
            transition: all 0.2s ease;
            color: #374151;
            letter-spacing: 0.01em;
        }

        .news-filter-btn:hover {
            border-color: #9ca3af;
            background: #f9fafb;
            color: #111827;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .news-filter-btn.active {
            background: #dc2626;
            border-color: #dc2626;
            color: white;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }

        .news-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-left: 3px solid #dc2626;
            border-radius: 8px;
            padding: 24px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .news-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: #dc2626;
            border-radius: 8px 0 0 8px;
            transition: width 0.2s ease;
        }

        .news-item:hover {
            border-color: #dc2626;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transform: translateX(4px);
        }

        .news-item:hover::before {
            width: 4px;
        }

        .news-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .news-source {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: #f9fafb;
            color: #374151;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .news-time {
            color: #6b7280;
            font-size: 0.8125em;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .news-title {
            font-size: 1.125em;
            font-weight: 700;
            color: #111827;
            margin-bottom: 10px;
            line-height: 1.5;
            letter-spacing: -0.01em;
        }

        .news-summary {
            color: #4b5563;
            font-size: 0.9375em;
            line-height: 1.7;
            margin-bottom: 16px;
        }

        .news-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .news-tag {
            padding: 5px 12px;
            background: white;
            color: #6b7280;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .event-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-left: 3px solid #dc2626;
            border-radius: 6px;
            padding: 18px 22px;
            display: grid;
            grid-template-columns: 130px 1fr auto;
            gap: 24px;
            align-items: center;
            transition: all 0.2s ease;
        }

        .event-item:hover {
            border-left-width: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transform: translateX(2px);
        }

        .event-time {
            font-weight: 600;
            color: #111827;
            font-size: 0.9375em;
            letter-spacing: -0.01em;
        }

        .event-date {
            color: #6b7280;
            font-size: 0.8125em;
            font-weight: 500;
            margin-top: 2px;
        }

        .event-title {
            font-weight: 700;
            color: #111827;
            margin-bottom: 6px;
            letter-spacing: -0.01em;
        }

        .event-desc {
            color: #4b5563;
            font-size: 0.875em;
            line-height: 1.5;
        }

        .event-impact {
            padding: 6px 16px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            border: 1px solid;
        }

        .impact-high {
            background: white;
            color: #dc2626;
            border-color: #dc2626;
        }

        .impact-medium {
            background: white;
            color: #f59e0b;
            border-color: #f59e0b;
        }

        .impact-low {
            background: white;
            color: #6b7280;
            border-color: #e5e7eb;
        }

        .earnings-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 20px;
            display: grid;
            grid-template-columns: 90px 1fr auto;
            gap: 20px;
            align-items: center;
            transition: all 0.2s ease;
        }

        .earnings-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .earnings-date {
            text-align: center;
            padding: 12px 8px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-weight: 700;
            color: #111827;
            font-size: 0.875em;
        }

        .earnings-company {
            font-weight: 700;
            color: #111827;
            font-size: 1.0625em;
            margin-bottom: 6px;
            letter-spacing: -0.01em;
        }

        .earnings-estimate {
            color: #6b7280;
            font-size: 0.875em;
        }

        .earnings-badge {
            padding: 8px 18px;
            background: #dc2626;
            color: white;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8125em;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .corporate-action {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 20px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 18px;
            align-items: center;
            transition: all 0.2s ease;
        }

        .corporate-action:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .action-icon {
            font-size: 2.2em;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .action-title {
            font-weight: 700;
            color: #111827;
            margin-bottom: 6px;
            letter-spacing: -0.01em;
        }

        .action-details {
            color: #6b7280;
            font-size: 0.875em;
            line-height: 1.5;
        }

        .action-date {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.8125em;
            color: #374151;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
        }

    </style>
    <script src="js/collapsible.js"></script>
    <script src="js/logo.js"></script>
    <script src="js/api-config.js"></script>
    <script src="js/stock-categories.js"></script>
    <script src="js/data-api.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/currency.js"></script>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <div class="logo-section">
                <span class="logo-icon">üìä</span>
                <a href="index.html" class="logo-text">VNStock Analytics</a>
                <span class="page-title" data-i18n="nav.macro">Macro Analysis</span>
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="nav-menu">
                    <button class="menu-btn" onclick="toggleMenu()">
                        üìä Dashboards
                        <span id="menuArrow">‚ñº</span>
                    </button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <div class="menu-header">All Dashboards</div>

                        <div class="menu-category">üìä Market Analysis</div>
                        <div class="menu-items">
                            <a href="dashboard.html" class="menu-item">
                                <span class="menu-item-icon">üìä</span>
                                <span data-i18n="nav.dashboard">Main Dashboard</span>
                            </a>
                            <a href="dashboard_history.html" class="menu-item">
                                <span class="menu-item-icon">üìä</span>
                                <span data-i18n="nav.history">Historical Analysis</span>
                            </a>
                            <a href="advanced_charts.html" class="menu-item">
                                <span class="menu-item-icon">üìâ</span>
                                <span data-i18n="nav.charts">Advanced Charts</span>
                            </a>
                        </div>

                        <div class="menu-category">üíº Investment Tools</div>
                        <div class="menu-items">
                            <a href="price_forecast.html" class="menu-item">
                                <span class="menu-item-icon">üîÆ</span>
                                <span data-i18n="macro.menu.price_forecasting">Price Forecasting</span>
                            </a>
                            <a href="dashboard_advanced.html" class="menu-item">
                                <span class="menu-item-icon">üìä</span>
                                <span data-i18n="nav.portfolio_analytics">Portfolio Analytics</span>
                            </a>
                            <a href="macro_analysis.html" class="menu-item">
                                <span class="menu-item-icon">üåç</span>
                                <span data-i18n="nav.macro">Macro Analysis</span>
                            </a>
                        </div>

                        <div class="menu-category">üîî Automation & Alerts</div>
                        <div class="menu-items">
                            <a href="alerts_system.html" class="menu-item">
                                <span class="menu-item-icon">üîî</span>
                                <span data-i18n="macro.menu.price_alerts">Price Alerts</span>
                            </a>
                            <a href="trading_automation.html" class="menu-item">
                                <span class="menu-item-icon">ü§ñ</span>
                                <span data-i18n="nav.automation">Trading Automation</span>
                            </a>
                        </div>
                    <a href="settings.html" class="menu-item">
                            <span class="menu-item-icon">‚öôÔ∏è</span>
                            <span data-i18n="nav.settings">Settings</span>
                        </a>

                    </div>
                

            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1>üåç <span data-i18n="macro.title">Macroeconomic & Environmental Analysis</span></h1>
            <p style="color: #666; font-size: 1.1em;" data-i18n="macro.subtitle">Global Factors Impact on Vietnamese Market</p>
            <p style="color: #94a3b8; font-size: 0.95em; margin-top: 8px; font-weight: 500;">
                üìÖ <span data-i18n="macro.last_updated">Last Updated</span>: <span id="reportTimestamp"></span>
            </p>
        </div>

        <!-- Market Sentiment -->
        <div class="card">
            <h2>üìä <span data-i18n="macro.market_sentiment">Overall Market Sentiment</span></h2>
            <div class="sentiment-bar">
                <div class="sentiment-indicator" id="sentimentIndicator"></div>
            </div>
            <div class="sentiment-label" id="sentimentLabel">Neutral</div>
            <div style="margin-top: 20px;">
                <p style="color: #64748b; text-align: center;" data-i18n="macro.sentiment_based_on">
                    Based on: Oil prices, geopolitical tensions, monetary policy, economic indicators, and market news
                </p>
            </div>
        </div>

        <!-- Alert Section -->
        <div id="alertsContainer"></div>

        <!-- Key Metrics -->
        <div class="card">
            <h2>üîë <span data-i18n="macro.key_indicators">Key Economic Indicators</span></h2>
            <div class="metric-grid">
                <div class="metric-box">
                    <div class="metric-label" data-i18n="macro.oil_price">Global Oil Price</div>
                    <div class="metric-value" id="oilPrice">$85.30</div>
                </div>
                <div class="metric-box" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <div class="metric-label" data-i18n="macro.gdp_growth">VN GDP Growth</div>
                    <div class="metric-value" id="gdpGrowth">6.5%</div>
                </div>
                <div class="metric-box" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    <div class="metric-label" data-i18n="macro.inflation">Inflation Rate</div>
                    <div class="metric-value" id="inflation">3.2%</div>
                </div>
                <div class="metric-box" style="background: linear-gradient(135deg, #c41c16 0%, #7f1d1d 100%);">
                    <div class="metric-label" data-i18n="macro.exchange_rate">USD/VND Rate</div>
                    <div class="metric-value" id="exchangeRate">24,250</div>
                </div>
                <div class="metric-box" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                    <div class="metric-label" data-i18n="macro.interest_rate">Interest Rate</div>
                    <div class="metric-value" id="interestRate">4.5%</div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="factors" onclick="switchTab('factors')" data-i18n="macro.tab.factors">Environmental Factors</div>
            <div class="tab" data-tab="commodities" onclick="switchTab('commodities')" data-i18n="macro.tab.commodities">Commodities Impact</div>
            <div class="tab" data-tab="geopolitical" onclick="switchTab('geopolitical')" data-i18n="macro.tab.geopolitical">Geopolitical Risks</div>
            <div class="tab" data-tab="policy" onclick="switchTab('policy')" data-i18n="macro.tab.policy">Policy Changes</div>
            <div class="tab" data-tab="news" onclick="switchTab('news')" data-i18n="macro.tab.news">News & Events</div>
            <div class="tab" data-tab="correlation" onclick="switchTab('correlation')" data-i18n="macro.tab.correlation">Factor Correlation</div>
        </div>

        <!-- Environmental Factors Tab -->
        <div class="tab-content active" id="factors">
            <div class="card">
                <h2>üåç <span data-i18n="macro.factors_impact">Environmental Factors Impact</span></h2>
                <div class="factors-grid" id="factorsGrid">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Commodities Tab -->
        <div class="tab-content" id="commodities">
            <div class="card">
                <h2>‚õΩ <span data-i18n="macro.commodities_energy">Commodities & Energy Impact</span></h2>
                <div class="chart-container">
                    <canvas id="commoditiesChart"></canvas>
                </div>

                <h3 style="margin-top: 30px; color: #1e3a5f;" data-i18n="macro.subheader.sector_impact">Sector Impact Analysis</h3>
                <table>
                    <thead>
                        <tr>
                            <th data-i18n="macro.table.commodity">Commodity</th>
                            <th data-i18n="macro.table.current_price">Current Price</th>
                            <th data-i18n="macro.table.change">Change</th>
                            <th data-i18n="macro.table.impact_level">Impact Level</th>
                            <th data-i18n="macro.table.affected_sectors">Affected Sectors</th>
                        </tr>
                    </thead>
                    <tbody id="commoditiesTable">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Geopolitical Risks Tab -->
        <div class="tab-content" id="geopolitical">
            <div class="card">
                <h2>‚ö†Ô∏è <span data-i18n="macro.geopolitical_assessment">Geopolitical Risk Assessment</span></h2>
                <div id="geopoliticalRisks"></div>

                <h3 style="margin-top: 30px; color: #1e3a5f;" data-i18n="macro.subheader.regional_tensions">Regional Tensions Impact</h3>
                <div class="chart-container">
                    <canvas id="geopoliticalChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Policy Changes Tab -->
        <div class="tab-content" id="policy">
            <div class="card">
                <h2>üìã <span data-i18n="macro.policy_regulatory">Policy & Regulatory Changes</span></h2>
                <div id="policyChanges"></div>

                <h3 style="margin-top: 30px; color: #1e3a5f;" data-i18n="macro.subheader.policy_timeline">Policy Impact Timeline</h3>
                <div class="chart-container">
                    <canvas id="policyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- News & Events Tab -->
        <div class="tab-content" id="news">
            <!-- News Sources Filter -->
            <div class="card" style="border: none; background: white; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                <h3 style="color: #111827; font-size: 1em; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 20px; color: #6b7280;">Filter News Sources</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                    <button class="news-filter-btn active" onclick="filterNews('all')" data-source="all">
                        All Sources
                    </button>
                    <button class="news-filter-btn" onclick="filterNews('vietnam')" data-source="vietnam">
                        Vietnam
                    </button>
                    <button class="news-filter-btn" onclick="filterNews('global')" data-source="global">
                        Global Markets
                    </button>
                    <button class="news-filter-btn" onclick="filterNews('economic')" data-source="economic">
                        Economic Data
                    </button>
                    <button class="news-filter-btn" onclick="filterNews('corporate')" data-source="corporate">
                        Corporate Actions
                    </button>
                    <button class="news-filter-btn" onclick="filterNews('earnings')" data-source="earnings">
                        Earnings
                    </button>
                </div>
            </div>

            <!-- Market Summary & Key Insights -->
            <div class="card collapsible" style="border: none; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                <h3 style="color: #111827; font-size: 1.125em; font-weight: 700; letter-spacing: -0.01em;">üìä Market Summary & Key Insights</h3>
                <div class="card-content">
                    <div id="marketSummary" style="display: grid; gap: 20px;">
                        <!-- Auto-generated summary will be inserted here -->
                        <div style="padding: 20px; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-left: 4px solid #dc2626; border-radius: 8px;">
                            <h4 style="margin: 0 0 12px 0; color: #991b1b; font-size: 0.95em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;">Market Overview</h4>
                            <p id="summaryOverview" style="margin: 0; color: #1f2937; line-height: 1.7; font-size: 0.95em;">
                                Analyzing latest market trends, news sentiment, and upcoming economic events...
                            </p>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                            <div style="padding: 16px; background: white; border: 1px solid #e5e7eb; border-radius: 8px;">
                                <div style="font-size: 0.8em; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">News Sentiment</div>
                                <div id="newsSentiment" style="font-size: 1.5em; font-weight: 700; color: #dc2626;">--</div>
                                <div id="sentimentLabel" style="font-size: 0.85em; color: #6b7280; margin-top: 4px;">Analyzing...</div>
                            </div>
                            <div style="padding: 16px; background: white; border: 1px solid #e5e7eb; border-radius: 8px;">
                                <div style="font-size: 0.8em; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Key Events This Week</div>
                                <div id="eventCount" style="font-size: 1.5em; font-weight: 700; color: #dc2626;">--</div>
                                <div style="font-size: 0.85em; color: #6b7280; margin-top: 4px;">Economic & Corporate</div>
                            </div>
                            <div style="padding: 16px; background: white; border: 1px solid #e5e7eb; border-radius: 8px;">
                                <div style="font-size: 0.8em; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Top Story</div>
                                <div id="topStory" style="font-size: 0.9em; font-weight: 600; color: #111827; line-height: 1.4; margin-top: 8px;">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Economic Calendar -->
            <div class="card collapsible" style="border: none; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                <h3 style="color: #111827; font-size: 1.125em; font-weight: 700; letter-spacing: -0.01em;">Economic Calendar ‚Äî This Week</h3>
                <div class="card-content">
                    <div id="economicCalendar" style="display: grid; gap: 12px;"></div>
                </div>
            </div>

            <!-- Live News Feed -->
            <div class="card collapsible" style="border: none; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                <h3 style="color: #111827; font-size: 1.125em; font-weight: 700; letter-spacing: -0.01em; display: flex; align-items: center; gap: 12px; flex-wrap: nowrap;">
                    <span style="flex-shrink: 0;">Latest Market News</span>
                    <button onclick="event.stopPropagation(); refreshNews();" style="padding: 8px 18px; background: #dc2626; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8125em; font-weight: 600; transition: all 0.2s; box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2); flex-shrink: 0;" onmouseover="this.style.background='#b91c1c'" onmouseout="this.style.background='#dc2626'">
                        üîÑ Refresh
                    </button>
                </h3>
                <div class="card-content">
                    <div id="newsContainer" style="display: grid; gap: 16px;"></div>
                </div>
            </div>

            <!-- Earnings Calendar -->
            <div class="card collapsible" style="border: none; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                <h3 style="color: #111827; font-size: 1.125em; font-weight: 700; letter-spacing: -0.01em;">Upcoming Earnings Releases</h3>
                <div class="card-content">
                    <div id="earningsCalendar" style="display: grid; gap: 12px;"></div>
                </div>
            </div>

            <!-- Corporate Actions -->
            <div class="card collapsible" style="border: none; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                <h3 style="color: #111827; font-size: 1.125em; font-weight: 700; letter-spacing: -0.01em;">Recent Corporate Actions</h3>
                <div class="card-content">
                    <div id="corporateActions" style="display: grid; gap: 12px;"></div>
                </div>
            </div>
        </div>

        <!-- Factor Correlation Tab -->
        <div class="tab-content" id="correlation">
            <div class="card">
                <h2>üîó <span data-i18n="macro.factor_correlation">Environmental Factor Correlation</span></h2>
                <p style="color: #64748b; margin-bottom: 20px;" data-i18n="macro.correlation_desc">
                    How different environmental factors correlate with Vietnamese stock market sectors
                </p>
                <div class="correlation-matrix">
                    <div class="chart-container">
                        <canvas id="correlationChart"></canvas>
                    </div>
                </div>

                <h3 style="margin-top: 30px; color: #1e3a5f;" data-i18n="macro.correlation_matrix">Correlation Matrix</h3>
                <table id="correlationTable"></table>
            </div>
        </div>
    </div>

    <script>
        let charts = {};

        // Translation fallback - if i18n.js hasn't loaded yet, return the key itself
        if (typeof t !== 'function') {
            window.t = function(key) {
                // Extract the last part of the key as fallback
                const parts = key.split('.');
                return parts[parts.length - 1].replace(/_/g, ' ');
            };
        }

        // Environmental factors data
        const environmentalFactors = {
            oil_price: {
                key: 'oil_prices',
                name: 'Global Oil Prices',
                icon: '‚õΩ',
                value: '$85.30',
                change: '+2.5%',
                trend: 'up',
                impact: 'high',
                description: 'Rising oil prices increase costs for transportation, manufacturing, and utilities',
                affected_positive: ['GAS', 'PLX', 'PVD', 'BSR'],
                affected_negative: ['VJC', 'HVN', 'VNL', 'TCM']
            },
            interest_rate: {
                key: 'interest_rates',
                name: 'Interest Rates',
                icon: 'üí∞',
                value: '4.5%',
                change: '+0.25%',
                trend: 'up',
                impact: 'high',
                description: 'Higher interest rates increase borrowing costs, affecting real estate and banking',
                affected_positive: ['VCB', 'TCB', 'MBB', 'BID'],
                affected_negative: ['VHM', 'VIC', 'NVL', 'PDR']
            },
            usd_vnd: {
                key: 'exchange_rate',
                name: 'USD/VND Exchange Rate',
                icon: 'üí±',
                value: '24,250',
                change: '-0.5%',
                trend: 'down',
                impact: 'medium',
                description: 'Weaker VND benefits exporters but increases import costs',
                affected_positive: ['FPT', 'CMG', 'VGI', 'HPG'],
                affected_negative: ['VNM', 'SAB', 'MSN', 'MWG']
            },
            china_economy: {
                key: 'china_growth',
                name: 'China Economic Growth',
                icon: 'üá®üá≥',
                value: '5.2%',
                change: '-0.3%',
                trend: 'down',
                impact: 'high',
                description: 'China slowdown affects Vietnam exports and manufacturing',
                affected_positive: [],
                affected_negative: ['HPG', 'HSG', 'NKG', 'DCM']
            },
            us_fed_policy: {
                key: 'us_fed',
                name: 'US Federal Reserve Policy',
                icon: 'üè¶',
                value: 'Hawkish',
                change: 'Tightening',
                trend: 'down',
                impact: 'high',
                description: 'Fed tightening reduces foreign investment in emerging markets',
                affected_positive: [],
                affected_negative: ['VN-Index', 'Blue Chips', 'All Sectors']
            },
            inflation: {
                key: 'vn_inflation',
                name: 'Vietnam Inflation',
                icon: 'üìà',
                value: '3.2%',
                change: '+0.1%',
                trend: 'up',
                impact: 'medium',
                description: 'Moderate inflation affects purchasing power and consumer spending',
                affected_positive: ['Real Estate', 'Commodities'],
                affected_negative: ['Consumer', 'Retail']
            },
            tech_war: {
                key: 'tech_war',
                name: 'US-China Tech War',
                icon: '‚öîÔ∏è',
                value: 'High Tension',
                change: 'Escalating',
                trend: 'down',
                impact: 'medium',
                description: 'Tech war creates opportunities for Vietnam manufacturing shift',
                affected_positive: ['FPT', 'CMG', 'SAM', 'VGI'],
                affected_negative: []
            },
            supply_chain: {
                key: 'supply_chain',
                name: 'Global Supply Chain',
                icon: 'üö¢',
                value: 'Improving',
                change: 'Normalizing',
                trend: 'up',
                impact: 'medium',
                description: 'Supply chain recovery improves manufacturing and exports',
                affected_positive: ['HSG', 'HPG', 'NKG', 'DCM'],
                affected_negative: []
            }
        };

        // Geopolitical risks
        const geopoliticalRisks = [
            {
                key: 'south_china_sea',
                event: 'South China Sea Tensions',
                risk_level: 'medium',
                probability: '40%',
                impact: 'High',
                affected_sectors: ['Defense', 'Maritime', 'Tourism'],
                description: 'Ongoing territorial disputes could affect regional trade and investment',
                stocks_affected: ['VJC', 'HVN', 'VTO', 'VNL']
            },
            {
                key: 'russia_ukraine',
                event: 'Russia-Ukraine Conflict',
                risk_level: 'high',
                probability: '90%',
                impact: 'Medium',
                affected_sectors: ['Energy', 'Agriculture', 'Commodities'],
                description: 'War drives up energy and food prices globally',
                stocks_affected: ['GAS', 'PLX', 'VNM', 'SAB']
            },
            {
                key: 'middle_east',
                event: 'Middle East Instability',
                risk_level: 'medium',
                probability: '50%',
                impact: 'High',
                affected_sectors: ['Oil & Gas', 'Transportation'],
                description: 'Regional conflicts threaten oil supply and prices',
                stocks_affected: ['PLX', 'PVD', 'BSR', 'VJC']
            },
            {
                key: 'us_china',
                event: 'US-China Trade Relations',
                risk_level: 'low',
                probability: '60%',
                impact: 'Medium',
                affected_sectors: ['Technology', 'Manufacturing', 'Exports'],
                description: 'Improving relations as manufacturing shifts to Vietnam',
                stocks_affected: ['FPT', 'CMG', 'HPG', 'HSG']
            }
        ];

        // Policy changes
        const policyChanges = [
            {
                key: 'digital_tax',
                policy: 'Digital Economy Tax Framework',
                date: '2026-Q1',
                type: 'Fiscal',
                impact: 'Positive',
                description: 'New framework supports digital businesses with tax incentives for AI and tech innovation',
                affected: ['Technology', 'E-commerce', 'Fintech'],
                stocks: ['FPT', 'CMG', 'VGI', 'MWG']
            },
            {
                key: 'green_bonds',
                policy: 'Green Bond Market Development',
                date: '2025-Q4',
                type: 'Environmental',
                impact: 'Positive',
                description: 'Government launches green bond program to fund renewable energy transition',
                affected: ['Utilities', 'Energy', 'Banking'],
                stocks: ['POW', 'REE', 'VCB', 'TCB']
            },
            {
                key: 'infrastructure',
                policy: 'Infrastructure Investment Acceleration',
                date: '2025-Q3',
                type: 'Fiscal',
                impact: 'Positive',
                description: 'Major infrastructure spending increase for high-speed rail and ports',
                affected: ['Construction', 'Transportation', 'Industrial'],
                stocks: ['HPG', 'HSG', 'CTD', 'HT1']
            },
            {
                key: 'fdi_incentives',
                policy: 'Foreign Investment Incentives',
                date: '2025-Q2',
                type: 'Regulatory',
                impact: 'Positive',
                description: 'Enhanced incentives for FDI in high-tech manufacturing and semiconductors',
                affected: ['Technology', 'Manufacturing', 'Industrial'],
                stocks: ['FPT', 'CMG', 'HPG', 'HSG']
            }
        ];

        // News data will be fetched from API
        let newsItems = [];

        function updateReportTimestamp() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            };
            const timestamp = now.toLocaleString('en-US', options);
            document.getElementById('reportTimestamp').textContent = timestamp;
        }

        async function init() {
            updateReportTimestamp();
            renderEnvironmentalFactors();
            renderGeopoliticalRisks();
            renderPolicyChanges();
            await renderNews(); // Fetch news from API
            renderCommoditiesImpact();
            renderCorrelationAnalysis();
            calculateOverallSentiment();
            generateAlerts();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }

        function renderEnvironmentalFactors() {
            const container = document.getElementById('factorsGrid');
            if (!container) {
                console.error('factorsGrid container not found');
                return;
            }

            let html = '';

            try {
                Object.values(environmentalFactors).forEach(factor => {
                    const changeClass = factor.trend === 'up' ? 'positive' : 'negative';
                    const impactColor = factor.impact === 'high' ? '#ef4444' :
                                       factor.impact === 'medium' ? '#f59e0b' : '#10b981';

                    // Use translation if available, otherwise use name
                    const factorName = (typeof t === 'function' ? t('macro.factor.' + factor.key) : factor.name) || factor.name;
                    const factorDesc = (typeof t === 'function' ? t('macro.factor.' + factor.key + '_desc') : factor.description) || factor.description;

                    html += `
                        <div class="factor-card" style="border-left-color: ${impactColor};">
                            <div class="factor-header">
                                <div class="factor-title">${factorName}</div>
                                <div class="factor-icon">${factor.icon}</div>
                            </div>
                            <div class="factor-value">${factor.value}</div>
                            <div class="factor-change ${changeClass}">${factor.change}</div>
                            <p style="color: #64748b; font-size: 0.9em; margin-top: 10px;">
                                ${factorDesc}
                            </p>
                        <div class="factor-impact">
                            ${factor.affected_positive.length > 0 ? `
                                <div class="impact-label">‚úÖ ${typeof t === 'function' ? t('macro.factor.positively_affected') : 'Positively Affected'}:</div>
                                <div class="impact-stocks">
                                    ${factor.affected_positive.map(s =>
                                        `<span class="stock-tag high">${s}</span>`
                                    ).join('')}
                                </div>
                            ` : ''}
                            ${factor.affected_negative.length > 0 ? `
                                <div class="impact-label" style="margin-top: 10px;">‚ùå ${typeof t === 'function' ? t('macro.factor.negatively_affected') : 'Negatively Affected'}:</div>
                                <div class="impact-stocks">
                                    ${factor.affected_negative.map(s =>
                                        `<span class="stock-tag negative">${s}</span>`
                                    ).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                });

                container.innerHTML = html;
            } catch (error) {
                console.error('Error rendering environmental factors:', error);
                container.innerHTML = '<p style="color: #dc2626; padding: 20px;">Error loading environmental factors. Please refresh the page.</p>';
            }
        }

        function renderGeopoliticalRisks() {
            const container = document.getElementById('geopoliticalRisks');
            let html = '';

            geopoliticalRisks.forEach(risk => {
                const riskClass = risk.risk_level === 'high' ? 'danger' :
                                 risk.risk_level === 'medium' ? 'warning' : 'info';

                const riskTitle = typeof t === 'function' ? t('macro.geo.' + risk.key) : risk.event;
                const riskDesc = typeof t === 'function' ? t('macro.geo.' + risk.key + '_desc') : risk.description;
                const probLabel = typeof t === 'function' ? t('macro.risk.probability') : 'Probability';
                const impactLabel = typeof t === 'function' ? t('macro.impact_label') : 'Impact';
                const impactValue = typeof t === 'function' ? t('macro.level.' + risk.impact.toLowerCase()) : risk.impact;
                const sectorsLabel = typeof t === 'function' ? t('macro.risk.sectors') : 'Affected Sectors';

                html += `
                    <div class="alert-box ${riskClass}" style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <h3 style="margin: 0;">${riskTitle}</h3>
                            <span class="risk-level ${risk.risk_level}">${risk.risk_level.toUpperCase()} RISK</span>
                        </div>
                        <p style="margin-bottom: 10px;">${riskDesc}</p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px;">
                            <div>
                                <strong>${probLabel}:</strong> ${risk.probability}
                            </div>
                            <div>
                                <strong>${impactLabel}:</strong> ${impactValue}
                            </div>
                            <div>
                                <strong>${sectorsLabel}:</strong> ${risk.affected_sectors.join(', ')}
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <strong>${typeof t === 'function' ? t('macro.risk.affected_stocks') : 'Affected Stocks'}:</strong>
                            ${risk.stocks_affected.map(s => `<span class="stock-tag">${s}</span>`).join(' ')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;

            // Create Regional Tensions Impact Chart
            renderRegionalTensionsChart();
        }

        function renderRegionalTensionsChart() {
            const ctx = document.getElementById('geopoliticalChart');

            // Translation helper
            const tr = (key, fallback) => typeof t === 'function' ? t(key) : fallback;

            charts.geopolitical = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [
                        tr('macro.geo.south_china_sea', 'South China Sea Tensions'),
                        tr('macro.geo.russia_ukraine', 'Russia-Ukraine War'),
                        tr('macro.geo.middle_east', 'Middle East Conflicts'),
                        tr('macro.geo.us_china', 'US-China Trade Tensions')
                    ],
                    datasets: [{
                        label: tr('macro.chart.risk_probability', 'Risk Probability (%)'),
                        data: [40, 90, 50, 60],
                        backgroundColor: 'rgba(239, 68, 68, 0.6)',
                        borderColor: '#ef4444',
                        borderWidth: 2,
                        yAxisID: 'y'
                    }, {
                        label: tr('macro.chart.market_impact', 'Market Impact Score'),
                        data: [75, 60, 80, 55],
                        backgroundColor: 'rgba(251, 146, 60, 0.6)',
                        borderColor: '#f97316',
                        borderWidth: 2,
                        yAxisID: 'y'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: tr('macro.chart.geopolitical_tensions', 'Geopolitical Tensions & Market Impact'),
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.y;
                                    if (context.datasetIndex === 0) {
                                        label += '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: tr('macro.chart.score_probability', 'Score / Probability (%)')
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: t('macro.chart.geopolitical_events')
                            }
                        }
                    }
                }
            });
        }

        function renderPolicyChanges() {
            const container = document.getElementById('policyChanges');
            let html = '';

            policyChanges.forEach(policy => {
                const impactColor = policy.impact === 'Positive' ? '#10b981' : '#ef4444';
                const impactBg = policy.impact === 'Positive' ? '#dcfce7' : '#fee2e2';

                html += `
                    <div class="news-item">
                        <div class="news-title">${t('macro.policy.' + policy.key)}</div>
                        <div class="news-meta">
                            <span>üìÖ ${policy.date}</span>
                            <span>üìã ${t('macro.policy.type_' + policy.type.toLowerCase())}</span>
                            <span style="background: ${impactBg}; color: ${impactColor}; padding: 2px 10px; border-radius: 10px; font-weight: 600;">
                                ${t('macro.impact.' + policy.impact.toLowerCase())}
                            </span>
                        </div>
                        <p style="color: #475569; margin-bottom: 10px;">${t('macro.policy.' + policy.key + '_desc')}</p>
                        <div>
                            <strong>${t('macro.policy.affected_sectors')}:</strong> ${policy.affected.join(', ')}
                        </div>
                        <div style="margin-top: 8px;">
                            <strong>${t('macro.policy.stocks')}:</strong>
                            ${policy.stocks.map(s => `<span class="stock-tag">${s}</span>`).join(' ')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;

            // Create Policy Impact Timeline Chart
            renderPolicyTimelineChart();
        }

        function renderPolicyTimelineChart() {
            const ctx = document.getElementById('policyChart');

            // Extract policy data for chart
            const labels = policyChanges.map(p => {
                const translated = t('macro.policy.' + p.key);
                return translated.length > 25 ? translated.substring(0, 25) + '...' : translated;
            });
            const impactScores = policyChanges.map(p => p.impact === 'Positive' ? 75 : 40);
            const colors = policyChanges.map(p => p.impact === 'Positive' ? 'rgba(16, 185, 129, 0.7)' : 'rgba(239, 68, 68, 0.7)');

            charts.policy = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Policy Impact Score',
                        data: impactScores,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.7', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y', // Horizontal bar chart
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: t('macro.chart.policy_timeline'),
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const policy = policyChanges[context.dataIndex];
                                    return [
                                        t('macro.impact_label') + ': ' + policy.impact,
                                        t('macro.policy.type') + ': ' + policy.type,
                                        t('macro.policy.date') + ': ' + policy.date
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: t('macro.chart.impact_score')
                            }
                        }
                    }
                }
            });
        }

        async function fetchNews() {
            try {
                const response = await fetch('/api/news?limit=10');
                const data = await response.json();

                if (data.success && data.news && data.news.length > 0) {
                    newsItems = data.news;
                    return true;
                } else {
                    console.error('No news data received');
                    return false;
                }
            } catch (error) {
                console.error('Error fetching news:', error);
                return false;
            }
        }

        async function renderNews() {
            const container = document.getElementById('newsContainer');

            // Show loading state
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #64748b;">
                    <div style="font-size: 24px; margin-bottom: 10px;">‚è≥</div>
                    <div>${t('macro.loading_news')}</div>
                </div>
            `;

            // Fetch news from API
            const success = await fetchNews();

            let html = '';

            if (!success || newsItems.length === 0) {
                // Show error message if fetch failed
                html = `
                    <div style="background: #fee2e2; padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444; margin-bottom: 20px;">
                        <strong>‚ö†Ô∏è ${t('common.error')}:</strong> ${t('macro.news_load_error')}
                    </div>
                `;
            } else {
                // Render news items
                newsItems.forEach(news => {
                    const affectedStocks = news.affected_stocks && news.affected_stocks.length > 0
                        ? news.affected_stocks.join(', ')
                        : t('common.none');

                    html += `
                        <div class="news-item">
                            <div class="news-title">
                                <a href="${news.url}" target="_blank" rel="noopener noreferrer" style="color: #1e3a5f; text-decoration: none; cursor: pointer;">
                                    ${news.title} üîó
                                </a>
                            </div>
                            <div class="news-meta">
                                <span>üìÖ ${news.date}</span>
                                <span class="news-sentiment ${news.sentiment}">${t('macro.sentiment.' + news.sentiment)}</span>
                                <span>${t('macro.impact_label')}: ${news.impact}</span>
                            </div>
                            ${news.description ? `<p style="color: #475569; margin-bottom: 10px;">${news.description}</p>` : ''}
                            <div>
                                <strong>${t('common.affected')}:</strong> ${affectedStocks}
                                ${news.source ? `<span style="margin-left: 15px; color: #94a3b8; font-size: 0.9em;">üì∞ ${news.source}</span>` : ''}
                            </div>
                        </div>
                    `;
                });
            }

            container.innerHTML = html;
        }

        function renderCommoditiesImpact() {
            const ctx = document.getElementById('commoditiesChart');

            charts.commodities = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan 1', 'Jan 8', 'Jan 15', 'Jan 22', 'Jan 29'],
                    datasets: [{
                        label: t('macro.chart.oil_price_barrel'),
                        data: [78, 82, 85, 83, 85],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        yAxisID: 'y'
                    }, {
                        label: t('macro.chart.vnindex'),
                        data: [1200, 1180, 1195, 1210, 1205],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: t('macro.chart.oil_vnindex')
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: t('macro.chart.oil_price') }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: t('macro.chart.vnindex') },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });

            // Commodities table
            const table = document.getElementById('commoditiesTable');
            table.innerHTML = `
                <tr>
                    <td>${t('macro.commodity.crude_oil')}</td>
                    <td>$85.30/barrel</td>
                    <td style="color: #10b981; font-weight: 600;">+2.5%</td>
                    <td><span class="risk-level high">${t('macro.level.high').toUpperCase()}</span></td>
                    <td>${t('macro.commodity.impact_oil')}</td>
                </tr>
                <tr>
                    <td>${t('macro.commodity.gold')}</td>
                    <td>5,520,000 VND/g</td>
                    <td style="color: #10b981; font-weight: 600;">+1.2%</td>
                    <td><span class="risk-level medium">${t('macro.level.medium').toUpperCase()}</span></td>
                    <td>${t('macro.commodity.impact_gold')}</td>
                </tr>
                <tr>
                    <td>${t('macro.commodity.steel')}</td>
                    <td>$650/ton</td>
                    <td style="color: #ef4444; font-weight: 600;">-0.8%</td>
                    <td><span class="risk-level medium">${t('macro.level.medium').toUpperCase()}</span></td>
                    <td>${t('macro.commodity.impact_steel')}</td>
                </tr>
                <tr>
                    <td>${t('macro.commodity.natural_gas')}</td>
                    <td>$2.85/MMBtu</td>
                    <td style="color: #10b981; font-weight: 600;">+3.5%</td>
                    <td><span class="risk-level high">${t('macro.level.high').toUpperCase()}</span></td>
                    <td>${t('macro.commodity.impact_gas')}</td>
                </tr>
            `;
        }

        function renderCorrelationAnalysis() {
            const ctx = document.getElementById('correlationChart');

            const factors = ['Oil Price', 'Interest Rate', 'USD/VND', 'China GDP', 'US Fed'];
            const sectors = ['Oil & Gas', 'Banks', 'Real Estate', 'Technology', 'Consumer'];

            // Simulated correlation data
            const correlationData = [
                [0.85, -0.45, -0.65, 0.35, -0.55],  // Oil & Gas
                [-0.25, 0.92, 0.15, -0.35, 0.88],   // Banks
                [-0.35, -0.78, 0.45, 0.55, -0.82],  // Real Estate
                [0.15, -0.15, 0.72, 0.68, -0.25],   // Technology
                [-0.45, 0.25, -0.55, 0.45, 0.35]    // Consumer
            ];

            charts.correlation = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: factors,
                    datasets: sectors.map((sector, i) => ({
                        label: sector,
                        data: correlationData[i],
                        backgroundColor: `hsla(${i * 72}, 70%, 60%, 0.6)`
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: t('macro.chart.correlation_analysis')
                        }
                    },
                    scales: {
                        y: {
                            min: -1,
                            max: 1,
                            title: { display: true, text: t('macro.chart.correlation_coefficient') }
                        }
                    }
                }
            });

            // Correlation matrix table
            const table = document.getElementById('correlationTable');
            let html = `<thead><tr><th>${t('macro.table.sector')}</th>`;
            factors.forEach(f => html += `<th>${f}</th>`);
            html += '</tr></thead><tbody>';

            sectors.forEach((sector, i) => {
                html += `<tr><th>${sector}</th>`;
                correlationData[i].forEach(corr => {
                    const color = corr > 0.5 ? '#10b981' : corr < -0.5 ? '#ef4444' : '#64748b';
                    html += `<td style="color: ${color}; font-weight: 600;">${corr.toFixed(2)}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody>';
            table.innerHTML = html;
        }

        function calculateOverallSentiment() {
            // Calculate based on multiple factors
            let score = 50; // Start neutral

            // Oil price impact
            if (environmentalFactors.oil_price.trend === 'up') score -= 5;

            // Interest rate impact
            if (environmentalFactors.interest_rate.trend === 'up') score -= 10;

            // Exchange rate impact
            if (environmentalFactors.usd_vnd.trend === 'down') score += 5;

            // China economy
            if (environmentalFactors.china_economy.trend === 'down') score -= 8;

            // US Fed policy
            if (environmentalFactors.us_fed_policy.value === 'Hawkish') score -= 10;

            // Supply chain
            if (environmentalFactors.supply_chain.trend === 'up') score += 8;

            // Normalize to 0-100
            score = Math.max(0, Math.min(100, score));

            // Position indicator
            const indicator = document.getElementById('sentimentIndicator');
            indicator.style.left = `${score}%`;

            // Set label
            const label = document.getElementById('sentimentLabel');
            if (score > 70) {
                label.textContent = t('macro.sentiment.bullish');
                label.style.color = '#10b981';
            } else if (score > 55) {
                label.textContent = t('macro.sentiment.bullish');
                label.style.color = '#84cc16';
            } else if (score >= 45) {
                label.textContent = t('macro.sentiment.neutral');
                label.style.color = '#f59e0b';
            } else if (score >= 30) {
                label.textContent = t('macro.sentiment.bearish');
                label.style.color = '#f97316';
            } else {
                label.textContent = t('macro.sentiment.bearish');
                label.style.color = '#ef4444';
            }
        }

        function generateAlerts() {
            const container = document.getElementById('alertsContainer');
            let html = '';

            // Check for high-impact conditions
            if (environmentalFactors.oil_price.trend === 'up' &&
                parseFloat(environmentalFactors.oil_price.change) > 2) {
                html += `
                    <div class="alert-box warning">
                        <strong>‚ö†Ô∏è ${t('macro.alert.high_oil')}</strong>
                        <p style="margin-top: 10px;">
                            Oil prices up ${environmentalFactors.oil_price.change}.
                            ${t('macro.alert.consider')}: ${t('common.sell')} airlines (VJC, HVN), ${t('common.buy')} oil & gas (GAS, PLX, PVD)
                        </p>
                    </div>
                `;
            }

            if (environmentalFactors.interest_rate.trend === 'up') {
                html += `
                    <div class="alert-box danger">
                        <strong>üö® ${t('macro.alert.interest_rate_increase')}</strong>
                        <p style="margin-top: 10px;">
                            ${t('macro.alert.rising_rates_negative')}
                            ${t('macro.alert.consider')}: ${t('common.sell')} VHM, VIC, NVL. ${t('common.buy')} VCB, TCB
                        </p>
                    </div>
                `;
            }

            geopoliticalRisks.forEach(risk => {
                if (risk.risk_level === 'high') {
                    html += `
                        <div class="alert-box danger">
                            <strong>üö® ${t('macro.alert.geopolitical_risk')}: ${risk.event}</strong>
                            <p style="margin-top: 10px;">
                                ${risk.description}. ${t('common.affected')}: ${risk.stocks_affected.join(', ')}
                            </p>
                        </div>
                    `;
                }
            });

            container.innerHTML = html;
        }

        // News & Events Functionality
        let currentNewsFilter = 'all';
        let newsData = [];

        // Sample news sources - In production, these would be RSS/API feeds
        const newsSources = {
            vietnam: [
                { name: 'VnExpress', icon: 'üáªüá≥', url: 'https://vnexpress.net/rss/kinh-doanh.rss' },
                { name: 'Cafef', icon: '‚òï', url: 'https://cafef.vn/rss/thi-truong.rss' },
                { name: 'VietStock', icon: 'üìä', url: 'https://vietstock.vn/rss' }
            ],
            global: [
                { name: 'Bloomberg', icon: 'üìà', url: 'https://feeds.bloomberg.com/markets/news.rss' },
                { name: 'Reuters', icon: 'üåç', url: 'https://www.reutersagency.com/feed/' },
                { name: 'WSJ', icon: 'üì∞', url: 'https://feeds.wsj.com/public/resources/xml/wsj/public/page/feed-atom.xml' },
                { name: 'Financial Times', icon: 'üìä', url: 'https://www.ft.com/?format=rss' }
            ]
        };

        // Mock news data (in production, fetch from RSS/API)
        const mockNewsData = [
            {
                id: 1,
                source: 'Bloomberg',
                sourceIcon: 'üìà',
                category: 'global',
                time: '2 hours ago',
                title: 'Fed Signals Potential Rate Cut in Q2 2026',
                summary: 'Federal Reserve Chair Jerome Powell indicated that interest rate cuts may be on the table in the second quarter as inflation continues to moderate.',
                tags: ['Fed', 'Interest Rates', 'US Economy'],
                impact: 'high',
                url: 'https://bloomberg.com'
            },
            {
                id: 2,
                source: 'VnExpress',
                sourceIcon: 'üáªüá≥',
                category: 'vietnam',
                time: '3 hours ago',
                title: 'VN-Index Rises 1.2% on Strong Banking Sector Performance',
                summary: 'The VN-Index gained 14.5 points as banking stocks rallied, with VCB and TCB leading the advance on strong Q4 earnings expectations.',
                tags: ['VN-Index', 'Banking', 'Stock Market'],
                impact: 'high',
                url: 'https://vnexpress.net'
            },
            {
                id: 3,
                source: 'Reuters',
                sourceIcon: 'üåç',
                category: 'global',
                time: '5 hours ago',
                title: 'Oil Prices Surge 3% on Middle East Tensions',
                summary: 'Brent crude jumped to $88/barrel amid escalating geopolitical risks in the Middle East, raising concerns about supply disruptions.',
                tags: ['Oil', 'Commodities', 'Geopolitics'],
                impact: 'high',
                url: 'https://reuters.com'
            },
            {
                id: 4,
                source: 'Cafef',
                sourceIcon: '‚òï',
                category: 'vietnam',
                time: '6 hours ago',
                title: 'Foreign Investors Net Buy VND 500 Billion on HOSE',
                summary: 'Foreign investors returned as net buyers with VND 500 billion in net buying value, focusing on VHM, VIC, and HPG stocks.',
                tags: ['Foreign Investment', 'HOSE', 'Market Flow'],
                impact: 'medium',
                url: 'https://cafef.vn'
            },
            {
                id: 5,
                source: 'Financial Times',
                sourceIcon: 'üìä',
                category: 'global',
                time: '8 hours ago',
                title: 'China GDP Growth Exceeds Expectations at 5.2%',
                summary: 'Chinese economy grew 5.2% in Q4, beating expectations and signaling resilience despite property sector challenges.',
                tags: ['China', 'GDP', 'Economic Data'],
                impact: 'medium',
                url: 'https://ft.com'
            },
            {
                id: 6,
                source: 'VietStock',
                sourceIcon: 'üìä',
                category: 'vietnam',
                time: '10 hours ago',
                title: 'State Bank Keeps Interest Rates Steady at 4.5%',
                summary: 'The State Bank of Vietnam maintained its policy rate at 4.5% citing balanced inflation and growth outlook.',
                tags: ['SBV', 'Monetary Policy', 'Interest Rates'],
                impact: 'high',
                url: 'https://vietstock.vn'
            }
        ];

        // Economic calendar mock data
        const economicEvents = [
            {
                date: 'Feb 5',
                time: '08:30',
                title: 'US Non-Farm Payrolls',
                description: 'January employment report',
                impact: 'high',
                expected: '180K jobs'
            },
            {
                date: 'Feb 5',
                time: '14:00',
                title: 'Vietnam CPI (YoY)',
                description: 'January inflation data',
                impact: 'high',
                expected: '3.4%'
            },
            {
                date: 'Feb 6',
                time: '10:00',
                title: 'China Trade Balance',
                description: 'January exports/imports',
                impact: 'medium',
                expected: '+$78.5B'
            },
            {
                date: 'Feb 7',
                time: '15:00',
                title: 'ECB Interest Rate Decision',
                description: 'February monetary policy meeting',
                impact: 'high',
                expected: '4.00%'
            },
            {
                date: 'Feb 8',
                time: '09:00',
                title: 'Vietnam GDP Growth',
                description: 'Q4 2025 economic growth',
                impact: 'high',
                expected: '6.5%'
            }
        ];

        // Earnings calendar mock data
        const earningsData = [
            { date: 'Feb 5', symbol: 'VCB', name: 'Vietcombank', estimate: 'EPS: 4,200 VND', status: 'Before Market' },
            { date: 'Feb 6', symbol: 'FPT', name: 'FPT Corporation', estimate: 'EPS: 3,800 VND', status: 'After Market' },
            { date: 'Feb 7', symbol: 'VNM', name: 'Vinamilk', estimate: 'EPS: 2,500 VND', status: 'Before Market' },
            { date: 'Feb 8', symbol: 'HPG', name: 'Hoa Phat Group', estimate: 'EPS: 1,900 VND', status: 'After Market' },
            { date: 'Feb 9', symbol: 'TCB', name: 'Techcombank', estimate: 'EPS: 3,500 VND', status: 'Before Market' }
        ];

        // Corporate actions mock data
        const corporateActionsData = [
            { icon: 'üí∞', type: 'Dividend', company: 'VCB - Vietcombank', details: 'Cash dividend 25% (2,500 VND/share)', date: 'Feb 15' },
            { icon: 'üìä', type: 'Stock Split', company: 'MWG - Mobile World', details: '2-for-1 stock split', date: 'Feb 20' },
            { icon: 'üîî', type: 'AGM', company: 'VIC - Vingroup', details: 'Annual General Meeting', date: 'Mar 5' },
            { icon: 'üíº', type: 'Rights Issue', company: 'HPG - Hoa Phat', details: 'Rights offering at 1:2 ratio', date: 'Mar 10' },
            { icon: 'ü§ù', type: 'M&A', company: 'FPT Corporation', details: 'Acquires AI startup for $50M', date: 'Feb 12' }
        ];

        // Filter news by category
        function filterNews(category) {
            currentNewsFilter = category;

            // Update button states
            document.querySelectorAll('.news-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-source="${category}"]`).classList.add('active');

            // Filter and display news
            loadNews();
        }

        // Load and display news
        // Update market summary with insights
        function updateMarketSummary() {
            // Calculate sentiment based on news impact
            const highImpactNews = mockNewsData.filter(n => n.impact === 'high');
            const positiveKeywords = ['rises', 'gains', 'rally', 'strong', 'growth', 'buy', 'increase'];
            const negativeKeywords = ['falls', 'decline', 'weak', 'sell', 'decrease', 'tensions', 'risk'];

            let sentimentScore = 0;
            mockNewsData.forEach(news => {
                const text = (news.title + ' ' + news.summary).toLowerCase();
                positiveKeywords.forEach(word => {
                    if (text.includes(word)) sentimentScore++;
                });
                negativeKeywords.forEach(word => {
                    if (text.includes(word)) sentimentScore--;
                });
            });

            // Update sentiment indicator
            let sentiment, sentimentLabel, sentimentColor;
            if (sentimentScore > 2) {
                sentiment = 'üòä Positive';
                sentimentLabel = 'Bullish market sentiment';
                sentimentColor = '#10b981';
            } else if (sentimentScore < -2) {
                sentiment = 'üòü Negative';
                sentimentLabel = 'Bearish market sentiment';
                sentimentColor = '#ef4444';
            } else {
                sentiment = 'üòê Neutral';
                sentimentLabel = 'Mixed market sentiment';
                sentimentColor = '#f59e0b';
            }

            document.getElementById('newsSentiment').textContent = sentiment;
            document.getElementById('newsSentiment').style.color = sentimentColor;
            document.getElementById('sentimentLabel').textContent = sentimentLabel;

            // Count events
            const totalEvents = economicEvents.length + earningsData.length + corporateActionsData.length;
            document.getElementById('eventCount').textContent = totalEvents;

            // Top story
            const topStory = highImpactNews[0] || mockNewsData[0];
            document.getElementById('topStory').textContent = topStory.title;

            // Generate overview summary
            const vietnamNews = mockNewsData.filter(n => n.category === 'vietnam').length;
            const globalNews = mockNewsData.filter(n => n.category === 'global').length;
            const highImpactCount = highImpactNews.length;

            const overview = `The market is showing ${sentimentLabel.toLowerCase()} with ${highImpactCount} high-impact stories. ` +
                `Currently tracking ${vietnamNews} Vietnam market updates and ${globalNews} global market developments. ` +
                `This week features ${economicEvents.length} key economic indicators, ${earningsData.length} earnings releases, ` +
                `and ${corporateActionsData.length} corporate actions that may influence trading decisions.`;

            document.getElementById('summaryOverview').textContent = overview;
        }

        function loadNews() {
            let filteredNews = mockNewsData;

            if (currentNewsFilter !== 'all') {
                filteredNews = mockNewsData.filter(news => news.category === currentNewsFilter);
            }

            const container = document.getElementById('newsContainer');

            if (filteredNews.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b; padding: 40px;">No news available for this category.</p>';
                return;
            }

            let html = '';
            filteredNews.forEach(news => {
                html += `
                    <div class="news-item" onclick="window.open('${news.url}', '_blank')">
                        <div class="news-header">
                            <span class="news-source">${news.sourceIcon} ${news.source}</span>
                            <span class="news-time">‚è∞ ${news.time}</span>
                        </div>
                        <div class="news-title">${news.title}</div>
                        <div class="news-summary">${news.summary}</div>
                        <div class="news-tags">
                            ${news.tags.map(tag => `<span class="news-tag">#${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Load economic calendar
        function loadEconomicCalendar() {
            const container = document.getElementById('economicCalendar');
            let html = '';

            economicEvents.forEach(event => {
                const impactClass = event.impact === 'high' ? 'impact-high' : event.impact === 'medium' ? 'impact-medium' : 'impact-low';
                html += `
                    <div class="event-item">
                        <div>
                            <div class="event-date">${event.date}</div>
                            <div class="event-time">${event.time}</div>
                        </div>
                        <div>
                            <div class="event-title">${event.title}</div>
                            <div class="event-desc">${event.description} - Expected: ${event.expected}</div>
                        </div>
                        <div class="event-impact ${impactClass}">
                            ${event.impact.toUpperCase()} IMPACT
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Load earnings calendar
        function loadEarningsCalendar() {
            const container = document.getElementById('earningsCalendar');
            let html = '';

            earningsData.forEach(earnings => {
                html += `
                    <div class="earnings-item">
                        <div class="earnings-date">${earnings.date}</div>
                        <div>
                            <div class="earnings-company">${earnings.symbol} - ${earnings.name}</div>
                            <div class="earnings-estimate">${earnings.estimate}</div>
                        </div>
                        <div class="earnings-badge">${earnings.status}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Load corporate actions
        function loadCorporateActions() {
            const container = document.getElementById('corporateActions');
            let html = '';

            corporateActionsData.forEach(action => {
                html += `
                    <div class="corporate-action">
                        <div class="action-icon">${action.icon}</div>
                        <div>
                            <div class="action-title">${action.type} - ${action.company}</div>
                            <div class="action-details">${action.details}</div>
                        </div>
                        <div class="action-date">${action.date}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Refresh news feed
        function refreshNews() {
            console.log('üîÑ Refreshing news feed...');
            // In production, this would fetch new data from API
            loadNews();
            loadEconomicCalendar();
            loadEarningsCalendar();
            loadCorporateActions();
            updateMarketSummary();

            // Show refresh animation
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'üîÑ Refreshing...';
            btn.disabled = true;

            setTimeout(() => {
                btn.innerHTML = '‚úÖ Updated!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 1000);
            }, 1500);
        }

        // Initialize news on page load
        function initNews() {
            loadNews();
            loadEconomicCalendar();
            loadEarningsCalendar();
            loadCorporateActions();
            updateMarketSummary();

            // Initialize collapsible sections after content loads
            setTimeout(() => {
                if (typeof initializeCollapsibleSections === 'function') {
                    initializeCollapsibleSections();

                    // Add onclick handlers to collapsible headers
                    document.querySelectorAll('.card.collapsible h3').forEach(header => {
                        if (!header.onclick) {
                            header.onclick = function() { toggleSection(this); };
                        }
                    });
                }
            }, 500);
        }

        // Call initNews after main init
        document.addEventListener('DOMContentLoaded', () => {
            initNews();
        });

        // Initialize
        init();
    </script>
    <script>
        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            const arrow = document.getElementById('menuArrow');
            menu.classList.toggle('active');
            arrow.textContent = menu.classList.contains('active') ? '‚ñ≤' : '‚ñº';
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            const menuBtn = event.target.closest('.menu-btn');
            if (!menuBtn && !event.target.closest('.dropdown-menu')) {
                menu.classList.remove('active');
                const arrow = document.getElementById('menuArrow');
                if (arrow) arrow.textContent = '‚ñº';
            }
        });
    </script>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3 data-i18n="menu.dashboards">Dashboards</h3>
                    <ul class="footer-links">
                        <li><a href="index.html" data-i18n="nav.home">Home</a></li>
                        <li><a href="dashboard.html" data-i18n="nav.dashboard">Main Dashboard</a></li>
                        <li><a href="dashboard_history.html" data-i18n="nav.history">Historical Analysis</a></li>
                        <li><a href="advanced_charts.html" data-i18n="nav.charts">Advanced Charts</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3 data-i18n="menu.tools">Tools</h3>
                    <ul class="footer-links">
                        <li><a href="price_forecast.html">Price Forecasting</a></li>
                        <li><a href="dashboard_advanced.html" data-i18n="portfolio.title">Portfolio Analytics</a></li>
                        <li><a href="macro_analysis.html" data-i18n="nav.macro">Macro Analysis</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3 data-i18n="menu.automation">Automation</h3>
                    <ul class="footer-links">
                        <li><a href="alerts_system.html">Price Alerts</a></li>
                        <li><a href="trading_automation.html" data-i18n="nav.automation">Trading Automation</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3 data-i18n="menu.platform">Platform</h3>
                    <ul class="footer-links">
                        <li><a href="../docs/api/API_SERVER_SETUP.html">API Documentation</a></li>
                        <li><a href="../docs/api/README_API.html">Quick Start</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p data-i18n="footer.copyright_full">¬© 2026 VNStock Analytics. Built with advanced AI and data analytics.</p>
                <p style="margin-top: 8px;" data-i18n="footer.disclaimer">For educational purposes only. Not financial advice. Trade at your own risk.</p>
            </div>
        </div>
    </footer>

</body>
</html>
